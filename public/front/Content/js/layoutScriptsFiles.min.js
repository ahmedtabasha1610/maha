(function (window, document, undefined) { 'use strict'; function toPX(element, attribute, value) { var rsLeft = element.runtimeStyle && element.runtimeStyle[attribute], left, style = element.style; return !/^-?[0-9]+\.?[0-9]*(?:px)?$/i.test(value) && /^-?\d/.test(value) && (left = style.left, rsLeft && (element.runtimeStyle.left = element.currentStyle.left), style.left = attribute === 'fontSize' ? '1em' : value || 0, value = style.pixelLeft + 'px', style.left = left, rsLeft && (element.runtimeStyle.left = rsLeft)), /^(thin|medium|thick)$/i.test(value) ? value : Math.round(parseFloat(value)) + 'px'; } function asInt(val) { return parseInt(val, 10); } function parseBackgroundSizePosition(value, element, attribute, index) { if (value = (value || '').split(','), value = value[index || 0] || value[0] || 'auto', value = _html2canvas.Util.trimText(value).split(' '), !(attribute === 'backgroundSize' && (!value[0] || value[0].match(/cover|contain|auto/)))) { if (value[0] = value[0].indexOf('%') === -1 ? toPX(element, attribute + 'X', value[0]) : value[0], value[1] === undefined) if (attribute === 'backgroundSize') return value[1] = 'auto', value; else value[1] = value[0]; value[1] = value[1].indexOf('%') === -1 ? toPX(element, attribute + 'Y', value[1]) : value[1]; } return value; } function backgroundBoundsFactory(prop, el, bounds, image, imageIndex, backgroundSize) { var bgposition = _html2canvas.Util.getCSS(el, prop, imageIndex), topPos, left, percentage, val; if (bgposition.length === 1 && (val = bgposition[0], bgposition = [], bgposition[0] = val, bgposition[1] = val), bgposition[0].toString().indexOf('%') !== -1) percentage = parseFloat(bgposition[0]) / 100, left = bounds.width * percentage, prop !== 'backgroundSize' && (left -= (backgroundSize || image).width * percentage); else if (prop === 'backgroundSize') if (bgposition[0] === 'auto') left = image.width; else if (/contain|cover/.test(bgposition[0])) { var resized = _html2canvas.Util.resizeBounds(image.width, image.height, bounds.width, bounds.height, bgposition[0]); left = resized.width, topPos = resized.height; } else left = parseInt(bgposition[0], 10); else left = parseInt(bgposition[0], 10); return bgposition[1] === 'auto' ? topPos = left / image.width * image.height : bgposition[1].toString().indexOf('%') !== -1 ? (percentage = parseFloat(bgposition[1]) / 100, topPos = bounds.height * percentage, prop !== 'backgroundSize' && (topPos -= (backgroundSize || image).height * percentage)) : topPos = parseInt(bgposition[1], 10), [left, topPos]; } function h2cRenderContext(width, height) { var storage = []; return { storage: storage, width: width, height: height, clip: function () { storage.push({ type: 'function', name: 'clip', 'arguments': arguments }); }, translate: function () { storage.push({ type: 'function', name: 'translate', 'arguments': arguments }); }, fill: function () { storage.push({ type: 'function', name: 'fill', 'arguments': arguments }); }, save: function () { storage.push({ type: 'function', name: 'save', 'arguments': arguments }); }, restore: function () { storage.push({ type: 'function', name: 'restore', 'arguments': arguments }); }, fillRect: function () { storage.push({ type: 'function', name: 'fillRect', 'arguments': arguments }); }, createPattern: function () { storage.push({ type: 'function', name: 'createPattern', 'arguments': arguments }); }, drawShape: function () { var shape = []; return storage.push({ type: 'function', name: 'drawShape', 'arguments': shape }), { moveTo: function () { shape.push({ name: 'moveTo', 'arguments': arguments }); }, lineTo: function () { shape.push({ name: 'lineTo', 'arguments': arguments }); }, arcTo: function () { shape.push({ name: 'arcTo', 'arguments': arguments }); }, bezierCurveTo: function () { shape.push({ name: 'bezierCurveTo', 'arguments': arguments }); }, quadraticCurveTo: function () { shape.push({ name: 'quadraticCurveTo', 'arguments': arguments }); } }; }, drawImage: function () { storage.push({ type: 'function', name: 'drawImage', 'arguments': arguments }); }, fillText: function () { storage.push({ type: 'function', name: 'fillText', 'arguments': arguments }); }, setVariable: function (variable, value) { return storage.push({ type: 'variable', name: variable, 'arguments': value }), value; } }; } function h2czContext(zindex) { return { zindex: zindex, children: [] }; } var _html2canvas = {}, previousElement, computedCSS, html2canvas; _html2canvas.Util = {}, _html2canvas.Util.log = function (a) { _html2canvas.logging && window.console && window.console.log && window.console.log(a); }, _html2canvas.Util.trimText = function (isNative) { return function (input) { return isNative ? isNative.apply(input) : ((input || '') + '').replace(/^\s+|\s+$/g, ''); }; }(String.prototype.trim), _html2canvas.Util.asFloat = function (v) { return parseFloat(v); }, function (TEXT_SHADOW_PROPERTY, TEXT_SHADOW_VALUES) { TEXT_SHADOW_PROPERTY = /((rgba|rgb)\([^\)]+\)(\s-?\d+px){0,})/g, TEXT_SHADOW_VALUES = /(-?\d+px)|(#.+)|(rgb\(.+\))|(rgba\(.+\))/g, _html2canvas.Util.parseTextShadows = function (value) { if (!value || value === 'none') return []; var shadows = value.match(TEXT_SHADOW_PROPERTY), results = []; for (var i = 0; shadows && i < shadows.length; i++) { var s = shadows[i].match(TEXT_SHADOW_VALUES); results.push({ color: s[0], offsetX: s[1] ? s[1].replace('px', '') : 0, offsetY: s[2] ? s[2].replace('px', '') : 0, blur: s[3] ? s[3].replace('px', '') : 0 }); } return results; }; }(), _html2canvas.Util.parseBackgroundImage = function (value) { var whitespace = ' \r\n\t', method, definition, prefix, prefix_i, block, results = [], c, mode = 0, numParen = 0, quote, args; var appendResult = function () { method && (definition.substr(0, 1) === '"' && (definition = definition.substr(1, definition.length - 2)), definition && args.push(definition), method.substr(0, 1) === '-' && (prefix_i = method.indexOf('-', 1) + 1) > 0 && (prefix = method.substr(0, prefix_i), method = method.substr(prefix_i)), results.push({ prefix: prefix, method: method.toLowerCase(), value: block, args: args })), args = [], method = prefix = definition = block = ''; }; appendResult(); for (var i = 0, ii = value.length; i < ii; i++) { if (c = value[i], mode === 0 && whitespace.indexOf(c) > -1) continue; switch (c) { case '"': quote ? quote === c && (quote = null) : quote = c; break; case '(': if (quote) break; else if (mode === 0) { mode = 1, block += c; continue; } else numParen++; break; case ')': if (quote) break; else if (mode === 1) if (numParen === 0) { mode = 0, block += c, appendResult(); continue; } else numParen--; break; case ',': if (quote) break; else if (mode === 0) { appendResult(); continue; } else if (mode === 1 && numParen === 0 && !method.match(/^url$/i)) { args.push(definition), definition = '', block += c; continue; } break; }block += c, mode === 0 ? method += c : definition += c; } return appendResult(), results; }, _html2canvas.Util.Bounds = function (element) { var clientRect, bounds = {}; return element.getBoundingClientRect && (clientRect = element.getBoundingClientRect(), bounds.top = clientRect.top, bounds.bottom = clientRect.bottom || clientRect.top + clientRect.height, bounds.left = clientRect.left, bounds.width = element.offsetWidth, bounds.height = element.offsetHeight), bounds; }, _html2canvas.Util.OffsetBounds = function (element) { var parent = element.offsetParent ? _html2canvas.Util.OffsetBounds(element.offsetParent) : { top: 0, left: 0 }; return { top: element.offsetTop + parent.top, bottom: element.offsetTop + element.offsetHeight + parent.top, left: element.offsetLeft + parent.left, width: element.offsetWidth, height: element.offsetHeight }; }, _html2canvas.Util.getCSS = function (element, attribute, index) { previousElement !== element && (computedCSS = document.defaultView.getComputedStyle(element, null)); var value = computedCSS[attribute]; if (/^background(Size|Position)$/.test(attribute)) return parseBackgroundSizePosition(value, element, attribute, index); else if (/border(Top|Bottom)(Left|Right)Radius/.test(attribute)) { var arr = value.split(' '); return arr.length <= 1 && (arr[1] = arr[0]), arr.map(asInt); } return value; }, _html2canvas.Util.resizeBounds = function (current_width, current_height, target_width, target_height, stretch_mode) { var target_ratio = target_width / target_height, current_ratio = current_width / current_height, output_width, output_height; return !stretch_mode || stretch_mode === 'auto' ? (output_width = target_width, output_height = target_height) : target_ratio < current_ratio ^ stretch_mode === 'contain' ? (output_height = target_height, output_width = target_height * current_ratio) : (output_width = target_width, output_height = target_width / current_ratio), { width: output_width, height: output_height }; }, _html2canvas.Util.BackgroundPosition = function (el, bounds, image, imageIndex, backgroundSize) { var result = backgroundBoundsFactory('backgroundPosition', el, bounds, image, imageIndex, backgroundSize); return { left: result[0], top: result[1] }; }, _html2canvas.Util.BackgroundSize = function (el, bounds, image, imageIndex) { var result = backgroundBoundsFactory('backgroundSize', el, bounds, image, imageIndex); return { width: result[0], height: result[1] }; }, _html2canvas.Util.Extend = function (options, defaults) { for (var key in options) options.hasOwnProperty(key) && (defaults[key] = options[key]); return defaults; }, _html2canvas.Util.Children = function (elem) { var children; try { children = elem.nodeName && elem.nodeName.toUpperCase() === 'IFRAME' ? elem.contentDocument || elem.contentWindow.document : function (array, ret) { return ret = [], array !== null && function (first, second, i, j, l) { if (i = first.length, j = 0, typeof second.length === 'number') for (l = second.length; j < l; j++)first[i++] = second[j]; else while (second[j] !== undefined) first[i++] = second[j++]; return first.length = i, first; }(ret, array), ret; }(elem.childNodes); } catch (ex) { _html2canvas.Util.log('html2canvas.Util.Children failed with exception: ' + ex.message); children = []; } return children; }, _html2canvas.Util.isTransparent = function (backgroundColor) { return backgroundColor === 'transparent' || backgroundColor === 'rgba(0, 0, 0, 0)'; }, _html2canvas.Util.Font = function (fontData) { return fontData = {}, function (font, fontSize, doc) { if (fontData[font + '-' + fontSize] !== undefined) return fontData[font + '-' + fontSize]; var container = doc.createElement('div'), img = doc.createElement('img'), span = doc.createElement('span'), sampleText = 'Hidden Text', baseline, middle, metricsObj; return container.style.visibility = 'hidden', container.style.fontFamily = font, container.style.fontSize = fontSize, container.style.margin = 0, container.style.padding = 0, doc.body.appendChild(container), img.src = 'data:image/gif;base64,R0lGODlhAQABAIABAP///wAAACwAAAAAAQABAAACAkQBADs=', img.width = 1, img.height = 1, img.style.margin = 0, img.style.padding = 0, img.style.verticalAlign = 'baseline', span.style.fontFamily = font, span.style.fontSize = fontSize, span.style.margin = 0, span.style.padding = 0, span.appendChild(doc.createTextNode(sampleText)), container.appendChild(span), container.appendChild(img), baseline = img.offsetTop - span.offsetTop + 1, container.removeChild(span), container.appendChild(doc.createTextNode(sampleText)), container.style.lineHeight = 'normal', img.style.verticalAlign = 'super', middle = img.offsetTop - container.offsetTop + 1, metricsObj = { baseline: baseline, lineWidth: 1, middle: middle }, fontData[font + '-' + fontSize] = metricsObj, doc.body.removeChild(container), metricsObj; }; }(), function (Util, Generate, reGradients) { function addScrollStops(grad) { return function (colorStop) { try { grad.addColorStop(colorStop.stop, colorStop.color); } catch (e) { Util.log(['failed to add color stop: ', e, '; tried to add: ', colorStop]); } }; } Util = _html2canvas.Util, Generate = {}, _html2canvas.Generate = Generate, reGradients = [/^(-webkit-linear-gradient)\(([a-z\s]+)([\w\d\.\s,%\(\)]+)\)$/, /^(-o-linear-gradient)\(([a-z\s]+)([\w\d\.\s,%\(\)]+)\)$/, /^(-webkit-gradient)\((linear|radial),\s((?:\d{1,3}%?)\s(?:\d{1,3}%?),\s(?:\d{1,3}%?)\s(?:\d{1,3}%?))([\w\d\.\s,%\(\)\-]+)\)$/, /^(-moz-linear-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?))([\w\d\.\s,%\(\)]+)\)$/, /^(-webkit-radial-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?)),\s(\w+)\s([a-z\-]+)([\w\d\.\s,%\(\)]+)\)$/, /^(-moz-radial-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?)),\s(\w+)\s?([a-z\-]*)([\w\d\.\s,%\(\)]+)\)$/, /^(-o-radial-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?)),\s(\w+)\s([a-z\-]+)([\w\d\.\s,%\(\)]+)\)$/], Generate.parseGradient = function (css, bounds) { var gradient, i, len = reGradients.length, m1, stop, m2, m2Len, step, m3, tl, tr, br, bl; for (i = 0; i < len; i += 1)if (m1 = css.match(reGradients[i]), m1) break; if (m1) switch (m1[1]) { case '-webkit-linear-gradient': case '-o-linear-gradient': gradient = { type: 'linear', x0: null, y0: null, x1: null, y1: null, colorStops: [] }; m2 = m1[2].match(/\w+/g); if (m2) for (m2Len = m2.length, i = 0; i < m2Len; i += 1)switch (m2[i]) { case 'top': gradient.y0 = 0; gradient.y1 = bounds.height; break; case 'right': gradient.x0 = bounds.width; gradient.x1 = 0; break; case 'bottom': gradient.y0 = bounds.height; gradient.y1 = 0; break; case 'left': gradient.x0 = 0; gradient.x1 = bounds.width; break; }gradient.x0 === null && gradient.x1 === null && (gradient.x0 = gradient.x1 = bounds.width / 2); gradient.y0 === null && gradient.y1 === null && (gradient.y0 = gradient.y1 = bounds.height / 2); m2 = m1[3].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)(?:\s\d{1,3}(?:%|px))?)+/g); if (m2) for (m2Len = m2.length, step = 1 / Math.max(m2Len - 1, 1), i = 0; i < m2Len; i += 1)m3 = m2[i].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\s*(\d{1,3})?(%|px)?/), m3[2] ? (stop = parseFloat(m3[2]), m3[3] === '%' ? stop /= 100 : stop /= bounds.width) : stop = i * step, gradient.colorStops.push({ color: m3[1], stop: stop }); break; case '-webkit-gradient': gradient = { type: m1[2] === 'radial' ? 'circle' : m1[2], x0: 0, y0: 0, x1: 0, y1: 0, colorStops: [] }; m2 = m1[3].match(/(\d{1,3})%?\s(\d{1,3})%?,\s(\d{1,3})%?\s(\d{1,3})%?/); m2 && (gradient.x0 = m2[1] * bounds.width / 100, gradient.y0 = m2[2] * bounds.height / 100, gradient.x1 = m2[3] * bounds.width / 100, gradient.y1 = m2[4] * bounds.height / 100); m2 = m1[4].match(/((?:from|to|color-stop)\((?:[0-9\.]+,\s)?(?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)\))+/g); if (m2) for (m2Len = m2.length, i = 0; i < m2Len; i += 1)m3 = m2[i].match(/(from|to|color-stop)\(([0-9\.]+)?(?:,\s)?((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\)/), stop = parseFloat(m3[2]), m3[1] === 'from' && (stop = 0), m3[1] === 'to' && (stop = 1), gradient.colorStops.push({ color: m3[3], stop: stop }); break; case '-moz-linear-gradient': gradient = { type: 'linear', x0: 0, y0: 0, x1: 0, y1: 0, colorStops: [] }; m2 = m1[2].match(/(\d{1,3})%?\s(\d{1,3})%?/); m2 && (gradient.x0 = m2[1] * bounds.width / 100, gradient.y0 = m2[2] * bounds.height / 100, gradient.x1 = bounds.width - gradient.x0, gradient.y1 = bounds.height - gradient.y0); m2 = m1[3].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)(?:\s\d{1,3}%)?)+/g); if (m2) for (m2Len = m2.length, step = 1 / Math.max(m2Len - 1, 1), i = 0; i < m2Len; i += 1)m3 = m2[i].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\s*(\d{1,3})?(%)?/), m3[2] ? (stop = parseFloat(m3[2]), m3[3] && (stop /= 100)) : stop = i * step, gradient.colorStops.push({ color: m3[1], stop: stop }); break; case '-webkit-radial-gradient': case '-moz-radial-gradient': case '-o-radial-gradient': gradient = { type: 'circle', x0: 0, y0: 0, x1: bounds.width, y1: bounds.height, cx: 0, cy: 0, rx: 0, ry: 0, colorStops: [] }; m2 = m1[2].match(/(\d{1,3})%?\s(\d{1,3})%?/); m2 && (gradient.cx = m2[1] * bounds.width / 100, gradient.cy = m2[2] * bounds.height / 100); m2 = m1[3].match(/\w+/); m3 = m1[4].match(/[a-z\-]*/); if (m2 && m3) switch (m3[0]) { case 'farthest-corner': case 'cover': case '': tl = Math.sqrt(Math.pow(gradient.cx, 2) + Math.pow(gradient.cy, 2)); tr = Math.sqrt(Math.pow(gradient.cx, 2) + Math.pow(gradient.y1 - gradient.cy, 2)); br = Math.sqrt(Math.pow(gradient.x1 - gradient.cx, 2) + Math.pow(gradient.y1 - gradient.cy, 2)); bl = Math.sqrt(Math.pow(gradient.x1 - gradient.cx, 2) + Math.pow(gradient.cy, 2)); gradient.rx = gradient.ry = Math.max(tl, tr, br, bl); break; case 'closest-corner': tl = Math.sqrt(Math.pow(gradient.cx, 2) + Math.pow(gradient.cy, 2)); tr = Math.sqrt(Math.pow(gradient.cx, 2) + Math.pow(gradient.y1 - gradient.cy, 2)); br = Math.sqrt(Math.pow(gradient.x1 - gradient.cx, 2) + Math.pow(gradient.y1 - gradient.cy, 2)); bl = Math.sqrt(Math.pow(gradient.x1 - gradient.cx, 2) + Math.pow(gradient.cy, 2)); gradient.rx = gradient.ry = Math.min(tl, tr, br, bl); break; case 'farthest-side': m2[0] === 'circle' ? gradient.rx = gradient.ry = Math.max(gradient.cx, gradient.cy, gradient.x1 - gradient.cx, gradient.y1 - gradient.cy) : (gradient.type = m2[0], gradient.rx = Math.max(gradient.cx, gradient.x1 - gradient.cx), gradient.ry = Math.max(gradient.cy, gradient.y1 - gradient.cy)); break; case 'closest-side': case 'contain': m2[0] === 'circle' ? gradient.rx = gradient.ry = Math.min(gradient.cx, gradient.cy, gradient.x1 - gradient.cx, gradient.y1 - gradient.cy) : (gradient.type = m2[0], gradient.rx = Math.min(gradient.cx, gradient.x1 - gradient.cx), gradient.ry = Math.min(gradient.cy, gradient.y1 - gradient.cy)); break; }m2 = m1[5].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)(?:\s\d{1,3}(?:%|px))?)+/g); if (m2) for (m2Len = m2.length, step = 1 / Math.max(m2Len - 1, 1), i = 0; i < m2Len; i += 1)m3 = m2[i].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\s*(\d{1,3})?(%|px)?/), m3[2] ? (stop = parseFloat(m3[2]), m3[3] === '%' ? stop /= 100 : stop /= bounds.width) : stop = i * step, gradient.colorStops.push({ color: m3[1], stop: stop }); break; }return gradient; }, Generate.Gradient = function (src, bounds) { if (bounds.width === 0 || bounds.height === 0) return; var canvas = document.createElement('canvas'), ctx = canvas.getContext('2d'), gradient, grad; if (canvas.width = bounds.width, canvas.height = bounds.height, gradient = _html2canvas.Generate.parseGradient(src, bounds), gradient) switch (gradient.type) { case 'linear': grad = ctx.createLinearGradient(gradient.x0, gradient.y0, gradient.x1, gradient.y1); gradient.colorStops.forEach(addScrollStops(grad)); ctx.fillStyle = grad; ctx.fillRect(0, 0, bounds.width, bounds.height); break; case 'circle': grad = ctx.createRadialGradient(gradient.cx, gradient.cy, 0, gradient.cx, gradient.cy, gradient.rx); gradient.colorStops.forEach(addScrollStops(grad)); ctx.fillStyle = grad; ctx.fillRect(0, 0, bounds.width, bounds.height); break; case 'ellipse': var canvasRadial = document.createElement('canvas'), ctxRadial = canvasRadial.getContext('2d'), ri = Math.max(gradient.rx, gradient.ry), di = ri * 2; canvasRadial.width = canvasRadial.height = di; grad = ctxRadial.createRadialGradient(gradient.rx, gradient.ry, 0, gradient.rx, gradient.ry, ri); gradient.colorStops.forEach(addScrollStops(grad)); ctxRadial.fillStyle = grad; ctxRadial.fillRect(0, 0, di, di); ctx.fillStyle = gradient.colorStops[gradient.colorStops.length - 1].color; ctx.fillRect(0, 0, canvas.width, canvas.height); ctx.drawImage(canvasRadial, gradient.cx - gradient.rx, gradient.cy - gradient.ry, 2 * gradient.rx, 2 * gradient.ry); break; }return canvas; }, Generate.ListAlpha = function (number) { var tmp = '', modulus; do modulus = number % 26, tmp = String.fromCharCode(modulus + 64) + tmp, number /= 26; while (number * 26 > 26); return tmp; }, Generate.ListRoman = function (number) { var romanArray = ['M', 'CM', 'D', 'CD', 'C', 'XC', 'L', 'XL', 'X', 'IX', 'V', 'IV', 'I'], decimal = [1000, 900, 500, 400, 100, 90, 50, 40, 10, 9, 5, 4, 1], roman = '', v, len = romanArray.length; if (number <= 0 || number >= 4000) return number; for (v = 0; v < len; v += 1)while (number >= decimal[v]) number -= decimal[v], roman += romanArray[v]; return roman; }; }(), _html2canvas.Parse = function (images, options) { function documentWidth() { return Math.max(Math.max(doc.body.scrollWidth, doc.documentElement.scrollWidth), Math.max(doc.body.offsetWidth, doc.documentElement.offsetWidth), Math.max(doc.body.clientWidth, doc.documentElement.clientWidth)); } function documentHeight() { return Math.max(Math.max(doc.body.scrollHeight, doc.documentElement.scrollHeight), Math.max(doc.body.offsetHeight, doc.documentElement.offsetHeight), Math.max(doc.body.clientHeight, doc.documentElement.clientHeight)); } function getCSSInt(element, attribute) { var val = parseInt(getCSS(element, attribute), 10); return isNaN(val) ? 0 : val; } function renderRect(ctx, x, y, w, h, bgcolor) { bgcolor !== 'transparent' && (ctx.setVariable('fillStyle', bgcolor), ctx.fillRect(x, y, w, h), numDraws += 1); } function capitalize(m, p1, p2) { return m.length > 0 ? p1 + p2.toUpperCase() : void 0; } function textTransform(text, transform) { switch (transform) { case 'lowercase': return text.toLowerCase(); case 'capitalize': return text.replace(/(^|\s|:|-|\(|\))([a-z])/g, capitalize); case 'uppercase': return text.toUpperCase(); default: return text; } } function noLetterSpacing(letter_spacing) { return /^(normal|none|0px)$/.test(letter_spacing); } function drawText(currentText, x, y, ctx) { currentText !== null && Util.trimText(currentText).length > 0 && (ctx.fillText(currentText, x, y), numDraws += 1); } function setTextVariables(ctx, el, text_decoration, color) { var align = !1, bold = getCSS(el, 'fontWeight'), family = getCSS(el, 'fontFamily'), size = getCSS(el, 'fontSize'), shadows = Util.parseTextShadows(getCSS(el, 'textShadow')); switch (parseInt(bold, 10)) { case 401: bold = 'bold'; break; case 400: bold = 'normal'; break; }return ctx.setVariable('fillStyle', color), ctx.setVariable('font', [getCSS(el, 'fontStyle'), getCSS(el, 'fontVariant'), bold, size, family].join(' ')), ctx.setVariable('textAlign', align ? 'right' : 'left'), shadows.length && (ctx.setVariable('shadowColor', shadows[0].color), ctx.setVariable('shadowOffsetX', shadows[0].offsetX), ctx.setVariable('shadowOffsetY', shadows[0].offsetY), ctx.setVariable('shadowBlur', shadows[0].blur)), text_decoration !== 'none' ? Util.Font(family, size, doc) : void 0; } function renderTextDecoration(ctx, text_decoration, bounds, metrics, color) { switch (text_decoration) { case 'underline': renderRect(ctx, bounds.left, Math.round(bounds.top + metrics.baseline + metrics.lineWidth), bounds.width, 1, color); break; case 'overline': renderRect(ctx, bounds.left, Math.round(bounds.top), bounds.width, 1, color); break; case 'line-through': renderRect(ctx, bounds.left, Math.ceil(bounds.top + metrics.middle + metrics.lineWidth), bounds.width, 1, color); break; } } function getTextBounds(state, text, textDecoration, isLast, transform) { var bounds; if (support.rangeBounds && !transform) (textDecoration !== 'none' || Util.trimText(text).length !== 0) && (bounds = textRangeBounds(text, state.node, state.textOffset)), state.textOffset += text.length; else if (state.node && typeof state.node.nodeValue === 'string') { var newTextNode = isLast ? state.node.splitText(text.length) : null; bounds = textWrapperBounds(state.node, transform), state.node = newTextNode; } return bounds; } function textRangeBounds(text, textNode, textOffset) { var range = doc.createRange(); return range.setStart(textNode, textOffset), range.setEnd(textNode, textOffset + text.length), range.getBoundingClientRect(); } function textWrapperBounds(oldTextNode, transform) { var parent = oldTextNode.parentNode, wrapElement = doc.createElement('wrapper'), backupText = oldTextNode.cloneNode(!0); wrapElement.appendChild(oldTextNode.cloneNode(!0)), parent.replaceChild(wrapElement, oldTextNode); var bounds = transform ? Util.OffsetBounds(wrapElement) : Util.Bounds(wrapElement); return parent.replaceChild(backupText, wrapElement), bounds; } function renderText(el, textNode, stack) { var ctx = stack.ctx, color = getCSS(el, 'color'), textDecoration = getCSS(el, 'textDecoration'), textAlign = getCSS(el, 'textAlign'), metrics, textList, state = { node: textNode, textOffset: 0 }; Util.trimText(textNode.nodeValue).length > 0 && (textNode.nodeValue = textTransform(textNode.nodeValue, getCSS(el, 'textTransform')), textAlign = textAlign.replace(['-webkit-auto'], ['auto']), textList = !options.letterRendering && /^(left|right|justify|auto)$/.test(textAlign) && noLetterSpacing(getCSS(el, 'letterSpacing')) ? textNode.nodeValue.split(/(\b| )/) : textNode.nodeValue.split(''), metrics = setTextVariables(ctx, el, textDecoration, color), options.chinese && textList.forEach(function (word, index) { /.*[\u4E00-\u9FA5].*$/.test(word) && (word = word.split(''), word.unshift(index, 1), textList.splice.apply(textList, word)); }), textList.forEach(function (text, index) { var bounds = getTextBounds(state, text, textDecoration, index < textList.length - 1, stack.transform.matrix); bounds && (drawText(text, bounds.left, bounds.bottom, ctx), renderTextDecoration(ctx, textDecoration, bounds, metrics, color)); })); } function listPosition(element, val) { var boundElement = doc.createElement('boundelement'), originalType, bounds; return boundElement.style.display = 'inline', originalType = element.style.listStyleType, element.style.listStyleType = 'none', boundElement.appendChild(doc.createTextNode(val)), element.insertBefore(boundElement, element.firstChild), bounds = Util.Bounds(boundElement), element.removeChild(boundElement), element.style.listStyleType = originalType, bounds; } function elementIndex(el) { var i = -1, count = 1, childs = el.parentNode.childNodes; if (el.parentNode) { while (childs[++i] !== el) childs[i].nodeType === 1 && count++; return count; } else return -1; } function listItemText(element, type) { var currentIndex = elementIndex(element), text; switch (type) { case 'decimal': text = currentIndex; break; case 'decimal-leading-zero': text = currentIndex.toString().length === 1 ? currentIndex = '0' + currentIndex.toString() : currentIndex.toString(); break; case 'upper-roman': text = _html2canvas.Generate.ListRoman(currentIndex); break; case 'lower-roman': text = _html2canvas.Generate.ListRoman(currentIndex).toLowerCase(); break; case 'lower-alpha': text = _html2canvas.Generate.ListAlpha(currentIndex).toLowerCase(); break; case 'upper-alpha': text = _html2canvas.Generate.ListAlpha(currentIndex); break; }return text + '. '; } function renderListItem(element, stack, elBounds) { var x, text, ctx = stack.ctx, type = getCSS(element, 'listStyleType'), listBounds; if (/^(decimal|decimal-leading-zero|upper-alpha|upper-latin|upper-roman|lower-alpha|lower-greek|lower-latin|lower-roman)$/i.test(type)) { if (text = listItemText(element, type), listBounds = listPosition(element, text), setTextVariables(ctx, element, 'none', getCSS(element, 'color')), getCSS(element, 'listStylePosition') === 'inside') ctx.setVariable('textAlign', 'left'), x = elBounds.left; else return; drawText(text, x, listBounds.bottom, ctx); } } function loadImage(src) { var img = images[src]; return img && img.succeeded === !0 ? img.img : !1; } function clipBounds(src, dst) { var x = Math.max(src.left, dst.left), y = Math.max(src.top, dst.top), x2 = Math.min(src.left + src.width, dst.left + dst.width), y2 = Math.min(src.top + src.height, dst.top + dst.height); return { left: x, top: y, width: x2 - x, height: y2 - y }; } function setZ(element, stack, parentStack) { var newContext, isPositioned = stack.cssPosition !== 'static', zIndex = isPositioned ? getCSS(element, 'zIndex') : 'auto', opacity = getCSS(element, 'opacity'), isFloated = getCSS(element, 'cssFloat') !== 'none'; stack.zIndex = newContext = h2czContext(zIndex), newContext.isPositioned = isPositioned, newContext.isFloated = isFloated, newContext.opacity = opacity, newContext.ownStacking = zIndex !== 'auto' || opacity < 1, parentStack && parentStack.zIndex.children.push(stack); } function renderImage(ctx, element, image, bounds, borders) { var paddingLeft = getCSSInt(element, 'paddingLeft'), paddingTop = getCSSInt(element, 'paddingTop'), paddingRight = getCSSInt(element, 'paddingRight'), paddingBottom = getCSSInt(element, 'paddingBottom'); drawImage(ctx, image, 0, 0, image.width, image.height, bounds.left + paddingLeft + borders[3].width, bounds.top + paddingTop + borders[0].width, bounds.width - (borders[1].width + borders[3].width + paddingLeft + paddingRight), bounds.height - (borders[0].width + borders[2].width + paddingTop + paddingBottom)); } function getBorderData(element) { return ['Top', 'Right', 'Bottom', 'Left'].map(function (side) { return { width: getCSSInt(element, 'border' + side + 'Width'), color: getCSS(element, 'border' + side + 'Color') }; }); } function getBorderRadiusData(element) { return ['TopLeft', 'TopRight', 'BottomRight', 'BottomLeft'].map(function (side) { return getCSS(element, 'border' + side + 'Radius'); }); } function bezierCurve(start, startControl, endControl, end) { var lerp = function (a, b, t) { return { x: a.x + (b.x - a.x) * t, y: a.y + (b.y - a.y) * t }; }; return { start: start, startControl: startControl, endControl: endControl, end: end, subdivide: function (t) { var ab = lerp(start, startControl, t), bc = lerp(startControl, endControl, t), cd = lerp(endControl, end, t), abbc = lerp(ab, bc, t), bccd = lerp(bc, cd, t), dest = lerp(abbc, bccd, t); return [bezierCurve(start, ab, abbc, dest), bezierCurve(dest, bccd, cd, end)]; }, curveTo: function (borderArgs) { borderArgs.push(['bezierCurve', startControl.x, startControl.y, endControl.x, endControl.y, end.x, end.y]); }, curveToReversed: function (borderArgs) { borderArgs.push(['bezierCurve', endControl.x, endControl.y, startControl.x, startControl.y, start.x, start.y]); } }; } function parseCorner(borderArgs, radius1, radius2, corner1, corner2, x, y) { radius1[0] > 0 || radius1[1] > 0 ? (borderArgs.push(['line', corner1[0].start.x, corner1[0].start.y]), corner1[0].curveTo(borderArgs), corner1[1].curveTo(borderArgs)) : borderArgs.push(['line', x, y]), (radius2[0] > 0 || radius2[1] > 0) && borderArgs.push(['line', corner2[0].start.x, corner2[0].start.y]); } function drawSide(borderData, radius1, radius2, outer1, inner1, outer2, inner2) { var borderArgs = []; return radius1[0] > 0 || radius1[1] > 0 ? (borderArgs.push(['line', outer1[1].start.x, outer1[1].start.y]), outer1[1].curveTo(borderArgs)) : borderArgs.push(['line', borderData.c1[0], borderData.c1[1]]), radius2[0] > 0 || radius2[1] > 0 ? (borderArgs.push(['line', outer2[0].start.x, outer2[0].start.y]), outer2[0].curveTo(borderArgs), borderArgs.push(['line', inner2[0].end.x, inner2[0].end.y]), inner2[0].curveToReversed(borderArgs)) : (borderArgs.push(['line', borderData.c2[0], borderData.c2[1]]), borderArgs.push(['line', borderData.c3[0], borderData.c3[1]])), radius1[0] > 0 || radius1[1] > 0 ? (borderArgs.push(['line', inner1[1].end.x, inner1[1].end.y]), inner1[1].curveToReversed(borderArgs)) : borderArgs.push(['line', borderData.c4[0], borderData.c4[1]]), borderArgs; } function calculateCurvePoints(bounds, borderRadius, borders) { var x = bounds.left, y = bounds.top, width = bounds.width, height = bounds.height, tlh = borderRadius[0][0], tlv = borderRadius[0][1], trh = borderRadius[1][0], trv = borderRadius[1][1], brh = borderRadius[2][0], brv = borderRadius[2][1], blh = borderRadius[3][0], blv = borderRadius[3][1], topWidth = width - trh, rightHeight = height - brv, bottomWidth = width - brh, leftHeight = height - blv; return { topLeftOuter: getCurvePoints(x, y, tlh, tlv).topLeft.subdivide(0.5), topLeftInner: getCurvePoints(x + borders[3].width, y + borders[0].width, Math.max(0, tlh - borders[3].width), Math.max(0, tlv - borders[0].width)).topLeft.subdivide(0.5), topRightOuter: getCurvePoints(x + topWidth, y, trh, trv).topRight.subdivide(0.5), topRightInner: getCurvePoints(x + Math.min(topWidth, width + borders[3].width), y + borders[0].width, topWidth > width + borders[3].width ? 0 : trh - borders[3].width, trv - borders[0].width).topRight.subdivide(0.5), bottomRightOuter: getCurvePoints(x + bottomWidth, y + rightHeight, brh, brv).bottomRight.subdivide(0.5), bottomRightInner: getCurvePoints(x + Math.min(bottomWidth, width + borders[3].width), y + Math.min(rightHeight, height + borders[0].width), Math.max(0, brh - borders[1].width), Math.max(0, brv - borders[2].width)).bottomRight.subdivide(0.5), bottomLeftOuter: getCurvePoints(x, y + leftHeight, blh, blv).bottomLeft.subdivide(0.5), bottomLeftInner: getCurvePoints(x + borders[3].width, y + leftHeight, Math.max(0, blh - borders[3].width), Math.max(0, blv - borders[2].width)).bottomLeft.subdivide(0.5) }; } function getBorderClip(element, borderPoints, borders, radius, bounds) { var backgroundClip = getCSS(element, 'backgroundClip'), borderArgs = []; switch (backgroundClip) { case 'content-box': case 'padding-box': parseCorner(borderArgs, radius[0], radius[1], borderPoints.topLeftInner, borderPoints.topRightInner, bounds.left + borders[3].width, bounds.top + borders[0].width); parseCorner(borderArgs, radius[1], radius[2], borderPoints.topRightInner, borderPoints.bottomRightInner, bounds.left + bounds.width - borders[1].width, bounds.top + borders[0].width); parseCorner(borderArgs, radius[2], radius[3], borderPoints.bottomRightInner, borderPoints.bottomLeftInner, bounds.left + bounds.width - borders[1].width, bounds.top + bounds.height - borders[2].width); parseCorner(borderArgs, radius[3], radius[0], borderPoints.bottomLeftInner, borderPoints.topLeftInner, bounds.left + borders[3].width, bounds.top + bounds.height - borders[2].width); break; default: parseCorner(borderArgs, radius[0], radius[1], borderPoints.topLeftOuter, borderPoints.topRightOuter, bounds.left, bounds.top); parseCorner(borderArgs, radius[1], radius[2], borderPoints.topRightOuter, borderPoints.bottomRightOuter, bounds.left + bounds.width, bounds.top); parseCorner(borderArgs, radius[2], radius[3], borderPoints.bottomRightOuter, borderPoints.bottomLeftOuter, bounds.left + bounds.width, bounds.top + bounds.height); parseCorner(borderArgs, radius[3], radius[0], borderPoints.bottomLeftOuter, borderPoints.topLeftOuter, bounds.left, bounds.top + bounds.height); break; }return borderArgs; } function parseBorders(element, bounds, borders) { var x = bounds.left, y = bounds.top, width = bounds.width, height = bounds.height, borderSide, bx, by, bw, bh, borderArgs, borderRadius = getBorderRadiusData(element), borderPoints = calculateCurvePoints(bounds, borderRadius, borders), borderData = { clip: getBorderClip(element, borderPoints, borders, borderRadius, bounds), borders: [] }; for (borderSide = 0; borderSide < 4; borderSide++)if (borders[borderSide].width > 0) { bx = x, by = y, bw = width, bh = height - borders[2].width; switch (borderSide) { case 0: bh = borders[0].width; borderArgs = drawSide({ c1: [bx, by], c2: [bx + bw, by], c3: [bx + bw - borders[1].width, by + bh], c4: [bx + borders[3].width, by + bh] }, borderRadius[0], borderRadius[1], borderPoints.topLeftOuter, borderPoints.topLeftInner, borderPoints.topRightOuter, borderPoints.topRightInner); break; case 1: bx = x + width - borders[1].width; bw = borders[1].width; borderArgs = drawSide({ c1: [bx + bw, by], c2: [bx + bw, by + bh + borders[2].width], c3: [bx, by + bh], c4: [bx, by + borders[0].width] }, borderRadius[1], borderRadius[2], borderPoints.topRightOuter, borderPoints.topRightInner, borderPoints.bottomRightOuter, borderPoints.bottomRightInner); break; case 2: by = by + height - borders[2].width; bh = borders[2].width; borderArgs = drawSide({ c1: [bx + bw, by + bh], c2: [bx, by + bh], c3: [bx + borders[3].width, by], c4: [bx + bw - borders[3].width, by] }, borderRadius[2], borderRadius[3], borderPoints.bottomRightOuter, borderPoints.bottomRightInner, borderPoints.bottomLeftOuter, borderPoints.bottomLeftInner); break; case 3: bw = borders[3].width; borderArgs = drawSide({ c1: [bx, by + bh + borders[2].width], c2: [bx, by], c3: [bx + bw, by + borders[0].width], c4: [bx + bw, by + bh] }, borderRadius[3], borderRadius[0], borderPoints.bottomLeftOuter, borderPoints.bottomLeftInner, borderPoints.topLeftOuter, borderPoints.topLeftInner); break; }borderData.borders.push({ args: borderArgs, color: borders[borderSide].color }); } return borderData; } function createShape(ctx, args) { var shape = ctx.drawShape(); return args.forEach(function (border, index) { shape[index === 0 ? 'moveTo' : border[0] + 'To'].apply(null, border.slice(1)); }), shape; } function renderBorders(ctx, borderArgs, color) { color !== 'transparent' && (ctx.setVariable('fillStyle', color), createShape(ctx, borderArgs), ctx.fill(), numDraws += 1); } function renderFormValue(el, bounds, stack) { var valueWrap = doc.createElement('valuewrap'), cssPropertyArray = ['lineHeight', 'textAlign', 'fontFamily', 'color', 'fontSize', 'paddingLeft', 'paddingTop', 'width', 'height', 'border', 'borderLeftWidth', 'borderTopWidth'], textValue, textNode; cssPropertyArray.forEach(function (property) { try { valueWrap.style[property] = getCSS(el, property); } catch (e) { Util.log('html2canvas: Parse: Exception caught in renderFormValue: ' + e.message); } }), valueWrap.style.borderColor = 'black', valueWrap.style.borderStyle = 'solid', valueWrap.style.display = 'block', valueWrap.style.position = 'absolute', (/^(submit|reset|button|text|password)$/.test(el.type) || el.nodeName === 'SELECT') && (valueWrap.style.lineHeight = getCSS(el, 'height')), valueWrap.style.top = bounds.top + 'px', valueWrap.style.left = bounds.left + 'px', textValue = el.nodeName === 'SELECT' ? (el.options[el.selectedIndex] || 0).text : el.value, textValue || (textValue = el.placeholder), textNode = doc.createTextNode(textValue), valueWrap.appendChild(textNode), body.appendChild(valueWrap), renderText(el, textNode, stack), body.removeChild(valueWrap); } function drawImage(ctx) { ctx.drawImage.apply(ctx, Array.prototype.slice.call(arguments, 1)), numDraws += 1; } function getPseudoElement(el, which) { var elStyle = window.getComputedStyle(el, which); if (!(elStyle && elStyle.content) || elStyle.content === 'none' || elStyle.content === '-moz-alt-content' || elStyle.display === 'none') return; var content = elStyle.content + '', first = content.substr(0, 1); first === content.substr(content.length - 1) && first.match(/'|"/) && (content = content.substr(1, content.length - 2)); var isImage = content.substr(0, 3) === 'url', elps = document.createElement(isImage ? 'img' : 'span'); return elps.className = pseudoHide + '-before ' + pseudoHide + '-after', Object.keys(elStyle).filter(indexedProperty).forEach(function (prop) { try { elps.style[prop] = elStyle[prop]; } catch (e) { Util.log(['Tried to assign readonly property ', prop, 'Error:', e]); } }), isImage ? elps.src = Util.parseBackgroundImage(content)[0].args[0] : elps.innerHTML = content, elps; } function indexedProperty(property) { return isNaN(window.parseInt(property, 10)); } function injectPseudoElements(el, stack) { var before = getPseudoElement(el, ':before'), after = getPseudoElement(el, ':after'); if (!(before || after)) return; before && (el.className += ' ' + pseudoHide + '-before', el.parentNode.insertBefore(before, el), parseElement(before, stack, !0), el.parentNode.removeChild(before), el.className = el.className.replace(pseudoHide + '-before', '').trim()), after && (el.className += ' ' + pseudoHide + '-after', el.appendChild(after), parseElement(after, stack, !0), el.removeChild(after), el.className = el.className.replace(pseudoHide + '-after', '').trim()); } function renderBackgroundRepeat(ctx, image, backgroundPosition, bounds) { var offsetX = Math.round(bounds.left + backgroundPosition.left), offsetY = Math.round(bounds.top + backgroundPosition.top); ctx.createPattern(image), ctx.translate(offsetX, offsetY), ctx.fill(), ctx.translate(-offsetX, -offsetY); } function backgroundRepeatShape(ctx, image, backgroundPosition, bounds, left, top, width, height) { var args = []; args.push(['line', Math.round(left), Math.round(top)]), args.push(['line', Math.round(left + width), Math.round(top)]), args.push(['line', Math.round(left + width), Math.round(height + top)]), args.push(['line', Math.round(left), Math.round(height + top)]), createShape(ctx, args), ctx.save(), ctx.clip(), renderBackgroundRepeat(ctx, image, backgroundPosition, bounds), ctx.restore(); } function renderBackgroundColor(ctx, backgroundBounds, bgcolor) { renderRect(ctx, backgroundBounds.left, backgroundBounds.top, backgroundBounds.width, backgroundBounds.height, bgcolor); } function renderBackgroundRepeating(el, bounds, ctx, image, imageIndex) { var backgroundSize = Util.BackgroundSize(el, bounds, image, imageIndex), backgroundPosition = Util.BackgroundPosition(el, bounds, image, imageIndex, backgroundSize), backgroundRepeat = getCSS(el, 'backgroundRepeat').split(',').map(Util.trimText); image = resizeImage(image, backgroundSize), backgroundRepeat = backgroundRepeat[imageIndex] || backgroundRepeat[0]; switch (backgroundRepeat) { case 'repeat-x': backgroundRepeatShape(ctx, image, backgroundPosition, bounds, bounds.left, bounds.top + backgroundPosition.top, 99999, image.height); break; case 'repeat-y': backgroundRepeatShape(ctx, image, backgroundPosition, bounds, bounds.left + backgroundPosition.left, bounds.top, image.width, 99999); break; case 'no-repeat': backgroundRepeatShape(ctx, image, backgroundPosition, bounds, bounds.left + backgroundPosition.left, bounds.top + backgroundPosition.top, image.width, image.height); break; default: renderBackgroundRepeat(ctx, image, backgroundPosition, { top: bounds.top, left: bounds.left, width: image.width, height: image.height }); break; } } function renderBackgroundImage(element, bounds, ctx) { var backgroundImage = getCSS(element, 'backgroundImage'), backgroundImages = Util.parseBackgroundImage(backgroundImage), image, imageIndex = backgroundImages.length; while (imageIndex--) { if (backgroundImage = backgroundImages[imageIndex], !backgroundImage.args || backgroundImage.args.length === 0) continue; var key = backgroundImage.method === 'url' ? backgroundImage.args[0] : backgroundImage.value; image = loadImage(key), image ? renderBackgroundRepeating(element, bounds, ctx, image, imageIndex) : Util.log('html2canvas: Error loading background:', backgroundImage); } } function resizeImage(image, bounds) { if (image.width === bounds.width && image.height === bounds.height) return image; var ctx, canvas = doc.createElement('canvas'); return canvas.width = bounds.width, canvas.height = bounds.height, ctx = canvas.getContext('2d'), drawImage(ctx, image, 0, 0, image.width, image.height, 0, 0, bounds.width, bounds.height), canvas; } function setOpacity(ctx, element, parentStack) { return ctx.setVariable('globalAlpha', getCSS(element, 'opacity') * (parentStack ? parentStack.opacity : 1)); } function removePx(str) { return str.replace('px', ''); } function getTransform(element, parentStack) { var transform = getCSS(element, 'transform') || getCSS(element, '-webkit-transform') || getCSS(element, '-moz-transform') || getCSS(element, '-ms-transform') || getCSS(element, '-o-transform'); var transformOrigin = getCSS(element, 'transform-origin') || getCSS(element, '-webkit-transform-origin') || getCSS(element, '-moz-transform-origin') || getCSS(element, '-ms-transform-origin') || getCSS(element, '-o-transform-origin') || '0px 0px'; transformOrigin = transformOrigin.split(' ').map(removePx).map(Util.asFloat); var matrix; if (transform && transform !== 'none') { var match = transform.match(transformRegExp); if (match) switch (match[1]) { case 'matrix': matrix = match[2].split(',').map(Util.trimText).map(Util.asFloat); break; } } return { origin: transformOrigin, matrix: matrix }; } function createStack(element, parentStack, bounds, transform) { var ctx = h2cRenderContext(parentStack ? bounds.width : documentWidth(), parentStack ? bounds.height : documentHeight()), stack = { ctx: ctx, opacity: setOpacity(ctx, element, parentStack), cssPosition: getCSS(element, 'position'), borders: getBorderData(element), transform: transform, clip: parentStack && parentStack.clip ? Util.Extend({}, parentStack.clip) : null }; return setZ(element, stack, parentStack), options.useOverflow === !0 && /(hidden|scroll|auto)/.test(getCSS(element, 'overflow')) === !0 && /(BODY)/i.test(element.nodeName) === !1 && (stack.clip = stack.clip ? clipBounds(stack.clip, bounds) : bounds), stack; } function getBackgroundBounds(borders, bounds, clip) { var backgroundBounds = { left: bounds.left + borders[3].width, top: bounds.top + borders[0].width, width: bounds.width - (borders[1].width + borders[3].width), height: bounds.height - (borders[0].width + borders[2].width) }; return clip && (backgroundBounds = clipBounds(backgroundBounds, clip)), backgroundBounds; } function getBounds(element, transform) { var bounds = transform.matrix ? Util.OffsetBounds(element) : Util.Bounds(element); return transform.origin[0] += bounds.left, transform.origin[1] += bounds.top, bounds; } function renderElement(element, parentStack, pseudoElement, ignoreBackground) { var transform = getTransform(element, parentStack), bounds = getBounds(element, transform), image, stack = createStack(element, parentStack, bounds, transform), borders = stack.borders, ctx = stack.ctx, backgroundBounds = getBackgroundBounds(borders, bounds, stack.clip), borderData = parseBorders(element, bounds, borders), backgroundColor = ignoreElementsRegExp.test(element.nodeName) ? '#efefef' : getCSS(element, 'backgroundColor'); createShape(ctx, borderData.clip), ctx.save(), ctx.clip(), backgroundBounds.height > 0 && backgroundBounds.width > 0 && !ignoreBackground ? (renderBackgroundColor(ctx, bounds, backgroundColor), renderBackgroundImage(element, backgroundBounds, ctx)) : ignoreBackground && (stack.backgroundColor = backgroundColor), ctx.restore(), borderData.borders.forEach(function (border) { renderBorders(ctx, border.args, border.color); }), pseudoElement || injectPseudoElements(element, stack); switch (element.nodeName) { case 'IMG': (image = loadImage(element.getAttribute('src'))) ? renderImage(ctx, element, image, bounds, borders) : Util.log('html2canvas: Error loading <img>:' + element.getAttribute('src')); break; case 'INPUT': /^(text|url|email|submit|button|reset)$/.test(element.type) && (element.value || element.placeholder || '').length > 0 && renderFormValue(element, bounds, stack); break; case 'TEXTAREA': (element.value || element.placeholder || '').length > 0 && renderFormValue(element, bounds, stack); break; case 'SELECT': (element.options || element.placeholder || '').length > 0 && renderFormValue(element, bounds, stack); break; case 'LI': renderListItem(element, stack, backgroundBounds); break; case 'CANVAS': renderImage(ctx, element, element, bounds, borders); break; }return stack; } function isElementVisible(element) { return getCSS(element, 'display') !== 'none' && getCSS(element, 'visibility') !== 'hidden' && !element.hasAttribute('data-html2canvas-ignore'); } function parseElement(element, stack, pseudoElement) { isElementVisible(element) && (stack = renderElement(element, stack, pseudoElement, !1) || stack, ignoreElementsRegExp.test(element.nodeName) || parseChildren(element, stack, pseudoElement)); } function parseChildren(element, stack, pseudoElement) { Util.Children(element).forEach(function (node) { node.nodeType === node.ELEMENT_NODE ? parseElement(node, stack, pseudoElement) : node.nodeType === node.TEXT_NODE && renderText(element, node, stack); }); } function init() { var background = getCSS(document.documentElement, 'backgroundColor'), transparentBackground = Util.isTransparent(background) && element === document.body, stack = renderElement(element, null, !1, transparentBackground); return parseChildren(element, stack), transparentBackground && (background = stack.backgroundColor), body.removeChild(hidePseudoElements), { backgroundColor: background, stack: stack }; } window.scroll(0, 0); var element = options.elements === undefined ? document.body : options.elements[0], numDraws = 0, doc = element.ownerDocument, Util = _html2canvas.Util, support = Util.Support(options, doc), ignoreElementsRegExp = new RegExp('(' + options.ignoreElements + ')'), body = doc.body, getCSS = Util.getCSS, pseudoHide = '___html2canvas___pseudoelement', hidePseudoElements = doc.createElement('style'); hidePseudoElements.innerHTML = '.' + pseudoHide + '-before:before { content: "" !important; display: none !important; }' + '.' + pseudoHide + '-after:after { content: "" !important; display: none !important; }', body.appendChild(hidePseudoElements), images = images || {}; var getCurvePoints = function (kappa) { return function (x, y, r1, r2) { var ox = r1 * kappa, oy = r2 * kappa, xm = x + r1, ym = y + r2; return { topLeft: bezierCurve({ x: x, y: ym }, { x: x, y: ym - oy }, { x: xm - ox, y: y }, { x: xm, y: y }), topRight: bezierCurve({ x: x, y: y }, { x: x + ox, y: y }, { x: xm, y: ym - oy }, { x: xm, y: ym }), bottomRight: bezierCurve({ x: xm, y: y }, { x: xm, y: y + oy }, { x: x + ox, y: ym }, { x: x, y: ym }), bottomLeft: bezierCurve({ x: xm, y: ym }, { x: xm - ox, y: ym }, { x: x, y: y + oy }, { x: x, y: y }) }; }; }(4 * ((Math.sqrt(2) - 1) / 3)); var transformRegExp = /(matrix)\((.+)\)/; return init(); }, _html2canvas.Preload = function (options) { function isSameOrigin(url) { link.href = url, link.href = link.href; var origin = link.protocol + link.host; return origin === pageOrigin; } function start() { Util.log('html2canvas: start: images: ' + images.numLoaded + ' / ' + images.numTotal + ' (failed: ' + images.numFailed + ')'), !images.firstRun && images.numLoaded >= images.numTotal && (Util.log('Finished loading images: # ' + images.numTotal + ' (failed: ' + images.numFailed + ')'), typeof options.complete === 'function' && options.complete(images)); } function proxyGetImage(url, img, imageObj) { var callback_name, scriptUrl = options.proxy, script; link.href = url, url = link.href, callback_name = 'html2canvas_' + count++ , imageObj.callbackname = callback_name, scriptUrl.indexOf('?') > -1 ? scriptUrl += '&' : scriptUrl += '?', scriptUrl += 'url=' + encodeURIComponent(url) + '&callback=' + callback_name, script = doc.createElement('script'), window[callback_name] = function (a) { a.substring(0, 6) === 'error:' ? (imageObj.succeeded = !1, images.numLoaded++ , images.numFailed++ , start()) : (setImageLoadHandlers(img, imageObj), img.src = a), window[callback_name] = undefined; try { delete window[callback_name]; } catch (ex) { } script.parentNode.removeChild(script), script = null, delete imageObj.script, delete imageObj.callbackname; }, script.setAttribute('type', 'text/javascript'), script.setAttribute('src', scriptUrl), imageObj.script = script, window.document.body.appendChild(script); } function loadPseudoElement(element, type) { var style = window.getComputedStyle(element, type), content = style.content; content.substr(0, 3) === 'url' && methods.loadImage(_html2canvas.Util.parseBackgroundImage(content)[0].args[0]), loadBackgroundImages(style.backgroundImage, element); } function loadPseudoElementImages(element) { loadPseudoElement(element, ':before'), loadPseudoElement(element, ':after'); } function loadGradientImage(backgroundImage, bounds) { var img = _html2canvas.Generate.Gradient(backgroundImage, bounds); img !== undefined && (images[backgroundImage] = { img: img, succeeded: !0 }, images.numTotal++ , images.numLoaded++ , start()); } function invalidBackgrounds(background_image) { return background_image && background_image.method && background_image.args && background_image.args.length > 0; } function loadBackgroundImages(background_image, el) { var bounds; _html2canvas.Util.parseBackgroundImage(background_image).filter(invalidBackgrounds).forEach(function (background_image) { background_image.method === 'url' ? methods.loadImage(background_image.args[0]) : background_image.method.match(/\-?gradient$/) && (bounds === undefined && (bounds = _html2canvas.Util.Bounds(el)), loadGradientImage(background_image.value, bounds)); }); } function getImages(el) { var elNodeType = !1; try { Util.Children(el).forEach(getImages); } catch (e) { } try { elNodeType = el.nodeType; } catch (ex) { elNodeType = false; Util.log("html2canvas: failed to access some element's nodeType - Exception: " + ex.message); } if (elNodeType === 1 || elNodeType === undefined) { loadPseudoElementImages(el); try { loadBackgroundImages(Util.getCSS(el, 'backgroundImage'), el); } catch (e) { Util.log('html2canvas: failed to get background-image - Exception: ' + e.message); } loadBackgroundImages(el); } } function setImageLoadHandlers(img, imageObj) { img.onload = function () { imageObj.timer !== undefined && window.clearTimeout(imageObj.timer), images.numLoaded++ , imageObj.succeeded = !0, img.onerror = img.onload = null, start(); }, img.onerror = function () { if (img.crossOrigin === 'anonymous' && (window.clearTimeout(imageObj.timer), options.proxy)) { var src = img.src; img = new Image(), imageObj.img = img, img.src = src, proxyGetImage(img.src, img, imageObj); return; } images.numLoaded++ , images.numFailed++ , imageObj.succeeded = !1, img.onerror = img.onload = null, start(); }; } var images = { numLoaded: 0, numFailed: 0, numTotal: 0, cleanupDone: !1 }, pageOrigin, Util = _html2canvas.Util, methods, i, count = 0, element = options.elements[0] || document.body, doc = element.ownerDocument, domImages = element.getElementsByTagName('img'), imgLen = domImages.length, link = doc.createElement('a'), supportCORS = function (img) { return img.crossOrigin !== undefined; }(new Image()), timeoutTimer; for (link.href = window.location.href, pageOrigin = link.protocol + link.host, methods = { loadImage: function (src) { var img, imageObj; src && images[src] === undefined && (img = new Image(), src.match(/data:image\/.*;base64,/i) ? (img.src = src.replace(/url\(['"]{0,}|['"]{0,}\)$/gi, ''), imageObj = images[src] = { img: img }, images.numTotal++ , setImageLoadHandlers(img, imageObj)) : isSameOrigin(src) || options.allowTaint === !0 ? (imageObj = images[src] = { img: img }, images.numTotal++ , setImageLoadHandlers(img, imageObj), img.src = src) : supportCORS && !options.allowTaint && options.useCORS ? (img.crossOrigin = 'anonymous', imageObj = images[src] = { img: img }, images.numTotal++ , setImageLoadHandlers(img, imageObj), img.src = src) : options.proxy && (imageObj = images[src] = { img: img }, images.numTotal++ , proxyGetImage(src, img, imageObj))); }, cleanupDOM: function (cause) { var img, src; if (!images.cleanupDone) { cause && typeof cause === 'string' ? Util.log('html2canvas: Cleanup because: ' + cause) : Util.log('html2canvas: Cleanup after timeout: ' + options.timeout + ' ms.'); for (src in images) if (images.hasOwnProperty(src) && (img = images[src], typeof img === 'object' && img.callbackname && img.succeeded === undefined)) { window[img.callbackname] = undefined; try { delete window[img.callbackname]; } catch (ex) { } img.script && img.script.parentNode && (img.script.setAttribute('src', 'about:blank'), img.script.parentNode.removeChild(img.script)), images.numLoaded++ , images.numFailed++ , Util.log("html2canvas: Cleaned up failed img: '" + src + "' Steps: " + images.numLoaded + ' / ' + images.numTotal); } window.stop !== undefined ? window.stop() : document.execCommand !== undefined && document.execCommand('Stop', !1), document.close !== undefined && document.close(), images.cleanupDone = !0, cause && typeof cause === 'string' || start(); } }, renderingDone: function () { timeoutTimer && window.clearTimeout(timeoutTimer); } }, options.timeout > 0 && (timeoutTimer = window.setTimeout(methods.cleanupDOM, options.timeout)), Util.log('html2canvas: Preload starts: finding background-images'), images.firstRun = !0, getImages(element), Util.log('html2canvas: Preload: Finding images'), i = 0; i < imgLen; i += 1)methods.loadImage(domImages[i].getAttribute('src')); return images.firstRun = !1, Util.log('html2canvas: Preload: Done.'), images.numTotal === images.numLoaded && start(), methods; }, _html2canvas.Renderer = function (parseQueue, options) { function createRenderQueue(parseQueue) { function sortZ(context) { Object.keys(context).sort().forEach(function (zi) { var nonPositioned = [], floated = [], positioned = [], list = []; context[zi].forEach(function (v) { v.node.zIndex.isPositioned || v.node.zIndex.opacity < 1 ? positioned.push(v) : v.node.zIndex.isFloated ? floated.push(v) : nonPositioned.push(v); }), function walk(arr) { arr.forEach(function (v) { list.push(v), v.children && walk(v.children); }); }(nonPositioned.concat(floated, positioned)), list.forEach(function (v) { v.context ? sortZ(v.context) : queue.push(v.node); }); }); } var queue = [], rootContext; return rootContext = function buildStackingContext(rootNode) { function insert(context, node, specialParent) { var zi = node.zIndex.zindex === 'auto' ? 0 : Number(node.zIndex.zindex), contextForChildren = context, isPositioned = node.zIndex.isPositioned, isFloated = node.zIndex.isFloated, stub = { node: node }, childrenDest = specialParent; node.zIndex.ownStacking ? (contextForChildren = stub.context = { '!': [{ node: node, children: [] }] }, childrenDest = undefined) : (isPositioned || isFloated) && (childrenDest = stub.children = []), zi === 0 && specialParent ? specialParent.push(stub) : (context[zi] || (context[zi] = []), context[zi].push(stub)), node.zIndex.children.forEach(function (childNode) { insert(contextForChildren, childNode, childrenDest); }); } var rootContext = {}; return insert(rootContext, rootNode), rootContext; }(parseQueue), sortZ(rootContext), queue; } function getRenderer(rendererName) { var renderer; if (typeof options.renderer === 'string' && _html2canvas.Renderer[rendererName] !== undefined) renderer = _html2canvas.Renderer[rendererName](options); else if (typeof rendererName === 'function') renderer = rendererName(options); else throw new Error('Unknown renderer'); if (typeof renderer !== 'function') throw new Error('Invalid renderer defined'); return renderer; } return getRenderer(options.renderer)(parseQueue, options, document, createRenderQueue(parseQueue.stack), _html2canvas); }, _html2canvas.Util.Support = function (options, doc) { function supportSVGRendering() { var img = new Image(), canvas = doc.createElement('canvas'), ctx = canvas.getContext === undefined ? !1 : canvas.getContext('2d'); if (ctx === !1) return !1; canvas.width = canvas.height = 10, img.src = ['data:image/svg+xml,', "<svg xmlns='http://www.w3.org/2000/svg' width='10' height='10'>", "<foreignObject width='10' height='10'>", "<div xmlns='http://www.w3.org/1999/xhtml' style='width:10;height:10;'>", 'sup', '</div>', '</foreignObject>', '</svg>'].join(''); try { ctx.drawImage(img, 0, 0), canvas.toDataURL(); } catch (e) { return false; } return _html2canvas.Util.log('html2canvas: Parse: SVG powered rendering available'), !0; } function supportRangeBounds() { var r, testElement, rangeBounds, rangeHeight, support = !1; return doc.createRange && (r = doc.createRange(), r.getBoundingClientRect) && (testElement = doc.createElement('boundtest'), testElement.style.height = '123px', testElement.style.display = 'block', doc.body.appendChild(testElement), r.selectNode(testElement), rangeBounds = r.getBoundingClientRect(), rangeHeight = rangeBounds.height, rangeHeight === 123 && (support = !0), doc.body.removeChild(testElement)), support; } return { rangeBounds: supportRangeBounds(), svgRendering: options.svgRendering && supportSVGRendering() }; }, window.html2canvas = function (elements, opts) { elements = elements.length ? elements : [elements]; var queue, canvas, options = { logging: !1, elements: elements, background: '#fff', proxy: null, timeout: 0, useCORS: !1, allowTaint: !1, svgRendering: !1, ignoreElements: 'IFRAME|OBJECT|PARAM', useOverflow: !0, letterRendering: !1, chinese: !1, width: null, height: null, taintTest: !0, renderer: 'Canvas' }; return options = _html2canvas.Util.Extend(opts, options), _html2canvas.logging = options.logging, options.complete = function (images) { if (typeof options.onpreloaded === 'function' && options.onpreloaded(images) === !1) return; if (queue = _html2canvas.Parse(images, options), typeof options.onparsed === 'function' && options.onparsed(queue) === !1) return; canvas = _html2canvas.Renderer(queue, options), typeof options.onrendered === 'function' && options.onrendered(canvas); }, window.setTimeout(function () { _html2canvas.Preload(options); }, 0), { render: function (queue, opts) { return _html2canvas.Renderer(queue, _html2canvas.Util.Extend(opts, options)); }, parse: function (images, opts) { return _html2canvas.Parse(images, _html2canvas.Util.Extend(opts, options)); }, preload: function (opts) { return _html2canvas.Preload(_html2canvas.Util.Extend(opts, options)); }, log: _html2canvas.Util.log }; }, window.html2canvas.log = _html2canvas.Util.log, window.html2canvas.Renderer = { Canvas: undefined }, _html2canvas.Renderer.Canvas = function (options) { function createShape(ctx, args) { ctx.beginPath(), args.forEach(function (arg) { ctx[arg.name].apply(ctx, arg['arguments']); }), ctx.closePath(); } function safeImage(item) { if (safeImages.indexOf(item['arguments'][0].src) === -1) { testctx.drawImage(item['arguments'][0], 0, 0); try { testctx.getImageData(0, 0, 1, 1); } catch (e) { testCanvas = doc.createElement('canvas'); testctx = testCanvas.getContext('2d'); return false; } safeImages.push(item['arguments'][0].src); } return !0; } function renderItem(ctx, item) { switch (item.type) { case 'variable': ctx[item.name] = item['arguments']; break; case 'function': switch (item.name) { case 'createPattern': if (item['arguments'][0].width > 0 && item['arguments'][0].height > 0) try { ctx.fillStyle = ctx.createPattern(item['arguments'][0], 'repeat'); } catch (e) { Util.log('html2canvas: Renderer: Error creating pattern', e.message); } break; case 'drawShape': createShape(ctx, item['arguments']); break; case 'drawImage': item['arguments'][8] > 0 && item['arguments'][7] > 0 && (!options.taintTest || options.taintTest && safeImage(item)) && ctx.drawImage.apply(ctx, item['arguments']); break; default: ctx[item.name].apply(ctx, item['arguments']); }break; } } options = options || {}; var doc = document, safeImages = [], testCanvas = document.createElement('canvas'), testctx = testCanvas.getContext('2d'), Util = _html2canvas.Util, canvas = options.canvas || doc.createElement('canvas'); return function (parsedData, options, document, queue, _html2canvas) { var ctx = canvas.getContext('2d'), newCanvas, bounds, fstyle, zStack = parsedData.stack; return canvas.width = canvas.style.width = options.width || zStack.ctx.width, canvas.height = canvas.style.height = options.height || zStack.ctx.height, fstyle = ctx.fillStyle, ctx.fillStyle = Util.isTransparent(zStack.backgroundColor) && options.background !== undefined ? options.background : parsedData.backgroundColor, ctx.fillRect(0, 0, canvas.width, canvas.height), ctx.fillStyle = fstyle, queue.forEach(function (storageContext) { ctx.textBaseline = 'bottom', ctx.save(), storageContext.transform.matrix && (ctx.translate(storageContext.transform.origin[0], storageContext.transform.origin[1]), ctx.transform.apply(ctx, storageContext.transform.matrix), ctx.translate(-storageContext.transform.origin[0], -storageContext.transform.origin[1])), storageContext.clip && (ctx.beginPath(), ctx.rect(storageContext.clip.left, storageContext.clip.top, storageContext.clip.width, storageContext.clip.height), ctx.clip()), storageContext.ctx.storage && storageContext.ctx.storage.forEach(function (item) { renderItem(ctx, item); }), ctx.restore(); }), Util.log('html2canvas: Renderer: Canvas renderer done - returning canvas obj'), options.elements.length === 1 && typeof options.elements[0] === 'object' && options.elements[0].nodeName !== 'BODY' ? (bounds = _html2canvas.Util.Bounds(options.elements[0]), newCanvas = document.createElement('canvas'), newCanvas.width = Math.ceil(bounds.width), newCanvas.height = Math.ceil(bounds.height), ctx = newCanvas.getContext('2d'), ctx.drawImage(canvas, bounds.left, bounds.top, bounds.width, bounds.height, 0, 0, bounds.width, bounds.height), canvas = null, newCanvas) : canvas; }; }; }(window, document), function (a) { 'function' == typeof define && define.amd ? define(['jquery'], a) : 'object' == typeof module && module.exports ? module.exports = a(require('jquery')) : a(jQuery); }(function (a) { a.extend(a.fn, { validate: function (b) { if (!this.length) return void (b && b.debug && window.console && console.warn("Nothing selected, can't validate, returning nothing.")); var c = a.data(this[0], 'validator'); return c ? c : (this.attr('novalidate', 'novalidate'), c = new a.validator(b, this[0]), a.data(this[0], 'validator', c), c.settings.onsubmit && (this.on('click.validate', ':submit', function (b) { c.submitButton = b.currentTarget, a(this).hasClass('cancel') && (c.cancelSubmit = !0), void 0 !== a(this).attr('formnovalidate') && (c.cancelSubmit = !0); }), this.on('submit.validate', function (b) { function d() { var d, e; return c.submitButton && (c.settings.submitHandler || c.formSubmitted) && (d = a("<input type='hidden'/>").attr('name', c.submitButton.name).val(a(c.submitButton).val()).appendTo(c.currentForm)), !c.settings.submitHandler || (e = c.settings.submitHandler.call(c, c.currentForm, b), d && d.remove(), void 0 !== e && e); } return c.settings.debug && b.preventDefault(), c.cancelSubmit ? (c.cancelSubmit = !1, d()) : c.form() ? c.pendingRequest ? (c.formSubmitted = !0, !1) : d() : (c.focusInvalid(), !1); })), c); }, valid: function () { var b, c, d; return a(this[0]).is('form') ? b = this.validate().form() : (d = [], b = !0, c = a(this[0].form).validate(), this.each(function () { b = c.element(this) && b, b || (d = d.concat(c.errorList)); }), c.errorList = d), b; }, rules: function (b, c) { var d, e, f, g, h, i, j = this[0]; if (null != j && (!j.form && j.hasAttribute('contenteditable') && (j.form = this.closest('form')[0], j.name = this.attr('name')), null != j.form)) { if (b) switch (d = a.data(j.form, 'validator').settings, e = d.rules, f = a.validator.staticRules(j), b) { case 'add': a.extend(f, a.validator.normalizeRule(c)), delete f.messages, e[j.name] = f, c.messages && (d.messages[j.name] = a.extend(d.messages[j.name], c.messages)); break; case 'remove': return c ? (i = {}, a.each(c.split(/\s/), function (a, b) { i[b] = f[b], delete f[b]; }), i) : (delete e[j.name], f); }return g = a.validator.normalizeRules(a.extend({}, a.validator.classRules(j), a.validator.attributeRules(j), a.validator.dataRules(j), a.validator.staticRules(j)), j), g.required && (h = g.required, delete g.required, g = a.extend({ required: h }, g)), g.remote && (h = g.remote, delete g.remote, g = a.extend(g, { remote: h })), g; } } }), a.extend(a.expr.pseudos || a.expr[':'], { blank: function (b) { return !a.trim('' + a(b).val()); }, filled: function (b) { var c = a(b).val(); return null !== c && !!a.trim('' + c); }, unchecked: function (b) { return !a(b).prop('checked'); } }), a.validator = function (b, c) { this.settings = a.extend(!0, {}, a.validator.defaults, b), this.currentForm = c, this.init(); }, a.validator.format = function (b, c) { return 1 === arguments.length ? function () { var c = a.makeArray(arguments); return c.unshift(b), a.validator.format.apply(this, c); } : void 0 === c ? b : (arguments.length > 2 && c.constructor !== Array && (c = a.makeArray(arguments).slice(1)), c.constructor !== Array && (c = [c]), a.each(c, function (a, c) { b = b.replace(new RegExp('\\{' + a + '\\}', 'g'), function () { return c; }); }), b); }, a.extend(a.validator, { defaults: { messages: {}, groups: {}, rules: {}, errorClass: 'error', pendingClass: 'pending', validClass: 'valid', errorElement: 'label', focusCleanup: !1, focusInvalid: !0, errorContainer: a([]), errorLabelContainer: a([]), onsubmit: !0, ignore: ':hidden', ignoreTitle: !1, onfocusin: function (a) { this.lastActive = a, this.settings.focusCleanup && (this.settings.unhighlight && this.settings.unhighlight.call(this, a, this.settings.errorClass, this.settings.validClass), this.hideThese(this.errorsFor(a))); }, onfocusout: function (a) { this.checkable(a) || !(a.name in this.submitted) && this.optional(a) || this.element(a); }, onkeyup: function (b, c) { var d = [16, 17, 18, 20, 35, 36, 37, 38, 39, 40, 45, 144, 225]; 9 === c.which && '' === this.elementValue(b) || a.inArray(c.keyCode, d) !== -1 || (b.name in this.submitted || b.name in this.invalid) && this.element(b); }, onclick: function (a) { a.name in this.submitted ? this.element(a) : a.parentNode.name in this.submitted && this.element(a.parentNode); }, highlight: function (b, c, d) { 'radio' === b.type ? this.findByName(b.name).addClass(c).removeClass(d) : a(b).addClass(c).removeClass(d); }, unhighlight: function (b, c, d) { 'radio' === b.type ? this.findByName(b.name).removeClass(c).addClass(d) : a(b).removeClass(c).addClass(d); } }, setDefaults: function (b) { a.extend(a.validator.defaults, b); }, messages: { required: 'This field is required.', remote: 'Please fix this field.', email: 'Please enter a valid email address.', url: 'Please enter a valid URL.', date: 'Please enter a valid date.', dateISO: 'Please enter a valid date (ISO).', number: 'Please enter a valid number.', digits: 'Please enter only digits.', equalTo: 'Please enter the same value again.', maxlength: a.validator.format('Please enter no more than {0} characters.'), minlength: a.validator.format('Please enter at least {0} characters.'), rangelength: a.validator.format('Please enter a value between {0} and {1} characters long.'), range: a.validator.format('Please enter a value between {0} and {1}.'), max: a.validator.format('Please enter a value less than or equal to {0}.'), min: a.validator.format('Please enter a value greater than or equal to {0}.'), step: a.validator.format('Please enter a multiple of {0}.') }, autoCreateRanges: !1, prototype: { init: function () { function b(b) { !this.form && this.hasAttribute('contenteditable') && (this.form = a(this).closest('form')[0], this.name = a(this).attr('name')); var c = a.data(this.form, 'validator'), d = 'on' + b.type.replace(/^validate/, ''), e = c.settings; e[d] && !a(this).is(e.ignore) && e[d].call(c, this, b); } this.labelContainer = a(this.settings.errorLabelContainer), this.errorContext = this.labelContainer.length && this.labelContainer || a(this.currentForm), this.containers = a(this.settings.errorContainer).add(this.settings.errorLabelContainer), this.submitted = {}, this.valueCache = {}, this.pendingRequest = 0, this.pending = {}, this.invalid = {}, this.reset(); var c, d = this.groups = {}; a.each(this.settings.groups, function (b, c) { 'string' == typeof c && (c = c.split(/\s/)), a.each(c, function (a, c) { d[c] = b; }); }), c = this.settings.rules, a.each(c, function (b, d) { c[b] = a.validator.normalizeRule(d); }), a(this.currentForm).on('focusin.validate focusout.validate keyup.validate', ":text, [type='password'], [type='file'], select, textarea, [type='number'], [type='search'], [type='tel'], [type='url'], [type='email'], [type='datetime'], [type='date'], [type='month'], [type='week'], [type='time'], [type='datetime-local'], [type='range'], [type='color'], [type='radio'], [type='checkbox'], [contenteditable], [type='button']", b).on('click.validate', "select, option, [type='radio'], [type='checkbox']", b), this.settings.invalidHandler && a(this.currentForm).on('invalid-form.validate', this.settings.invalidHandler); }, form: function () { return this.checkForm(), a.extend(this.submitted, this.errorMap), this.invalid = a.extend({}, this.errorMap), this.valid() || a(this.currentForm).triggerHandler('invalid-form', [this]), this.showErrors(), this.valid(); }, checkForm: function () { this.prepareForm(); for (var a = 0, b = this.currentElements = this.elements(); b[a]; a++)this.check(b[a]); return this.valid(); }, element: function (b) { var c, d, e = this.clean(b), f = this.validationTargetFor(e), g = this, h = !0; return void 0 === f ? delete this.invalid[e.name] : (this.prepareElement(f), this.currentElements = a(f), d = this.groups[f.name], d && a.each(this.groups, function (a, b) { b === d && a !== f.name && (e = g.validationTargetFor(g.clean(g.findByName(a))), e && e.name in g.invalid && (g.currentElements.push(e), h = g.check(e) && h)); }), c = this.check(f) !== !1, h = h && c, c ? this.invalid[f.name] = !1 : this.invalid[f.name] = !0, this.numberOfInvalids() || (this.toHide = this.toHide.add(this.containers)), this.showErrors(), a(b).attr('aria-invalid', !c)), h; }, showErrors: function (b) { if (b) { var c = this; a.extend(this.errorMap, b), this.errorList = a.map(this.errorMap, function (a, b) { return { message: a, element: c.findByName(b)[0] }; }), this.successList = a.grep(this.successList, function (a) { return !(a.name in b); }); } this.settings.showErrors ? this.settings.showErrors.call(this, this.errorMap, this.errorList) : this.defaultShowErrors(); }, resetForm: function () { a.fn.resetForm && a(this.currentForm).resetForm(), this.invalid = {}, this.submitted = {}, this.prepareForm(), this.hideErrors(); var b = this.elements().removeData('previousValue').removeAttr('aria-invalid'); this.resetElements(b); }, resetElements: function (a) { var b; if (this.settings.unhighlight) for (b = 0; a[b]; b++)this.settings.unhighlight.call(this, a[b], this.settings.errorClass, ''), this.findByName(a[b].name).removeClass(this.settings.validClass); else a.removeClass(this.settings.errorClass).removeClass(this.settings.validClass); }, numberOfInvalids: function () { return this.objectLength(this.invalid); }, objectLength: function (a) { var b, c = 0; for (b in a) void 0 !== a[b] && null !== a[b] && a[b] !== !1 && c++; return c; }, hideErrors: function () { this.hideThese(this.toHide); }, hideThese: function (a) { a.not(this.containers).text(''), this.addWrapper(a).hide(); }, valid: function () { return 0 === this.size(); }, size: function () { return this.errorList.length; }, focusInvalid: function () { if (this.settings.focusInvalid) try { a(this.findLastActive() || this.errorList.length && this.errorList[0].element || []).filter(':visible').focus().trigger('focusin'); } catch (b) { } }, findLastActive: function () { var b = this.lastActive; return b && 1 === a.grep(this.errorList, function (a) { return a.element.name === b.name; }).length && b; }, elements: function () { var b = this, c = {}; return a(this.currentForm).find('input, select, textarea, [contenteditable]').not(':submit, :reset, :image, :disabled').not(this.settings.ignore).filter(function () { var d = this.name || a(this).attr('name'); return !d && b.settings.debug && window.console && console.error('%o has no name assigned', this), this.hasAttribute('contenteditable') && (this.form = a(this).closest('form')[0], this.name = d), !(d in c || !b.objectLength(a(this).rules())) && (c[d] = !0, !0); }); }, clean: function (b) { return a(b)[0]; }, errors: function () { var b = this.settings.errorClass.split(' ').join('.'); return a(this.settings.errorElement + '.' + b, this.errorContext); }, resetInternals: function () { this.successList = [], this.errorList = [], this.errorMap = {}, this.toShow = a([]), this.toHide = a([]); }, reset: function () { this.resetInternals(), this.currentElements = a([]); }, prepareForm: function () { this.reset(), this.toHide = this.errors().add(this.containers); }, prepareElement: function (a) { this.reset(), this.toHide = this.errorsFor(a); }, elementValue: function (b) { var c, d, e = a(b), f = b.type; return 'radio' === f || 'checkbox' === f ? this.findByName(b.name).filter(':checked').val() : 'number' === f && void 0 !== b.validity ? b.validity.badInput ? 'NaN' : e.val() : (c = b.hasAttribute('contenteditable') ? e.text() : e.val(), 'file' === f ? 'C:\\fakepath\\' === c.substr(0, 12) ? c.substr(12) : (d = c.lastIndexOf('/'), d >= 0 ? c.substr(d + 1) : (d = c.lastIndexOf('\\'), d >= 0 ? c.substr(d + 1) : c)) : 'string' == typeof c ? c.replace(/\r/g, '') : c); }, check: function (b) { b = this.validationTargetFor(this.clean(b)); var c, d, e, f, g = a(b).rules(), h = a.map(g, function (a, b) { return b; }).length, i = !1, j = this.elementValue(b); if ('function' == typeof g.normalizer ? f = g.normalizer : 'function' == typeof this.settings.normalizer && (f = this.settings.normalizer), f) { if (j = f.call(b, j), 'string' != typeof j) throw new TypeError('The normalizer should return a string value.'); delete g.normalizer; } for (d in g) { e = { method: d, parameters: g[d] }; try { if (c = a.validator.methods[d].call(this, j, b, e.parameters), 'dependency-mismatch' === c && 1 === h) { i = !0; continue; } if (i = !1, 'pending' === c) return void (this.toHide = this.toHide.not(this.errorsFor(b))); if (!c) return this.formatAndAdd(b, e), !1; } catch (k) { throw this.settings.debug && window.console && console.log('Exception occurred when checking element ' + b.id + ", check the '" + e.method + "' method.", k), k instanceof TypeError && (k.message += '.  Exception occurred when checking element ' + b.id + ", check the '" + e.method + "' method."), k; } } return i ? void 0 : (this.objectLength(g) && this.successList.push(b), !0); }, customDataMessage: function (b, c) { return a(b).data('msg' + c.charAt(0).toUpperCase() + c.substring(1).toLowerCase()) || a(b).data('msg'); }, customMessage: function (a, b) { var c = this.settings.messages[a]; return c && (c.constructor === String ? c : c[b]); }, findDefined: function () { for (var a = 0; a < arguments.length; a++)if (void 0 !== arguments[a]) return arguments[a]; }, defaultMessage: function (b, c) { 'string' == typeof c && (c = { method: c }); var d = this.findDefined(this.customMessage(b.name, c.method), this.customDataMessage(b, c.method), !this.settings.ignoreTitle && b.title || void 0, a.validator.messages[c.method], '<strong>Warning: No message defined for ' + b.name + '</strong>'), e = /\$?\{(\d+)\}/g; return 'function' == typeof d ? d = d.call(this, c.parameters, b) : e.test(d) && (d = a.validator.format(d.replace(e, '{$1}'), c.parameters)), d; }, formatAndAdd: function (a, b) { var c = this.defaultMessage(a, b); this.errorList.push({ message: c, element: a, method: b.method }), this.errorMap[a.name] = c, this.submitted[a.name] = c; }, addWrapper: function (a) { return this.settings.wrapper && (a = a.add(a.parent(this.settings.wrapper))), a; }, defaultShowErrors: function () { var a, b, c; for (a = 0; this.errorList[a]; a++)c = this.errorList[a], this.settings.highlight && this.settings.highlight.call(this, c.element, this.settings.errorClass, this.settings.validClass), this.showLabel(c.element, c.message); if (this.errorList.length && (this.toShow = this.toShow.add(this.containers)), this.settings.success) for (a = 0; this.successList[a]; a++)this.showLabel(this.successList[a]); if (this.settings.unhighlight) for (a = 0, b = this.validElements(); b[a]; a++)this.settings.unhighlight.call(this, b[a], this.settings.errorClass, this.settings.validClass); this.toHide = this.toHide.not(this.toShow), this.hideErrors(), this.addWrapper(this.toShow).show(); }, validElements: function () { return this.currentElements.not(this.invalidElements()); }, invalidElements: function () { return a(this.errorList).map(function () { return this.element; }); }, showLabel: function (b, c) { var d, e, f, g, h = this.errorsFor(b), i = this.idOrName(b), j = a(b).attr('aria-describedby'); h.length ? (h.removeClass(this.settings.validClass).addClass(this.settings.errorClass), h.html(c)) : (h = a('<' + this.settings.errorElement + '>').attr('id', i + '-error').addClass(this.settings.errorClass).html(c || ''), d = h, this.settings.wrapper && (d = h.hide().show().wrap('<' + this.settings.wrapper + '/>').parent()), this.labelContainer.length ? this.labelContainer.append(d) : this.settings.errorPlacement ? this.settings.errorPlacement.call(this, d, a(b)) : d.insertAfter(b), h.is('label') ? h.attr('for', i) : 0 === h.parents("label[for='" + this.escapeCssMeta(i) + "']").length && (f = h.attr('id'), j ? j.match(new RegExp('\\b' + this.escapeCssMeta(f) + '\\b')) || (j += ' ' + f) : j = f, a(b).attr('aria-describedby', j), e = this.groups[b.name], e && (g = this, a.each(g.groups, function (b, c) { c === e && a("[name='" + g.escapeCssMeta(b) + "']", g.currentForm).attr('aria-describedby', h.attr('id')); })))), !c && this.settings.success && (h.text(''), 'string' == typeof this.settings.success ? h.addClass(this.settings.success) : this.settings.success(h, b)), this.toShow = this.toShow.add(h); }, errorsFor: function (b) { var c = this.escapeCssMeta(this.idOrName(b)), d = a(b).attr('aria-describedby'), e = "label[for='" + c + "'], label[for='" + c + "'] *"; return d && (e = e + ', #' + this.escapeCssMeta(d).replace(/\s+/g, ', #')), this.errors().filter(e); }, escapeCssMeta: function (a) { return a.replace(/([\\!"#$%&'()*+,.\/:;<=>?@\[\]^`{|}~])/g, '\\$1'); }, idOrName: function (a) { return this.groups[a.name] || (this.checkable(a) ? a.name : a.id || a.name); }, validationTargetFor: function (b) { return this.checkable(b) && (b = this.findByName(b.name)), a(b).not(this.settings.ignore)[0]; }, checkable: function (a) { return /radio|checkbox/i.test(a.type); }, findByName: function (b) { return a(this.currentForm).find("[name='" + this.escapeCssMeta(b) + "']"); }, getLength: function (b, c) { switch (c.nodeName.toLowerCase()) { case 'select': return a('option:selected', c).length; case 'input': if (this.checkable(c)) return this.findByName(c.name).filter(':checked').length; }return b.length; }, depend: function (a, b) { return !this.dependTypes[typeof a] || this.dependTypes[typeof a](a, b); }, dependTypes: { boolean: function (a) { return a; }, string: function (b, c) { return !!a(b, c.form).length; }, 'function': function (a, b) { return a(b); } }, optional: function (b) { var c = this.elementValue(b); return !a.validator.methods.required.call(this, c, b) && 'dependency-mismatch'; }, startRequest: function (b) { this.pending[b.name] || (this.pendingRequest++ , a(b).addClass(this.settings.pendingClass), this.pending[b.name] = !0); }, stopRequest: function (b, c) { this.pendingRequest-- , this.pendingRequest < 0 && (this.pendingRequest = 0), delete this.pending[b.name], a(b).removeClass(this.settings.pendingClass), c && 0 === this.pendingRequest && this.formSubmitted && this.form() ? (a(this.currentForm).submit(), this.submitButton && a("input:hidden[name='" + this.submitButton.name + "']", this.currentForm).remove(), this.formSubmitted = !1) : !c && 0 === this.pendingRequest && this.formSubmitted && (a(this.currentForm).triggerHandler('invalid-form', [this]), this.formSubmitted = !1); }, previousValue: function (b, c) { return c = 'string' == typeof c && c || 'remote', a.data(b, 'previousValue') || a.data(b, 'previousValue', { old: null, valid: !0, message: this.defaultMessage(b, { method: c }) }); }, destroy: function () { this.resetForm(), a(this.currentForm).off('.validate').removeData('validator').find('.validate-equalTo-blur').off('.validate-equalTo').removeClass('validate-equalTo-blur'); } }, classRuleSettings: { required: { required: !0 }, email: { email: !0 }, url: { url: !0 }, date: { date: !0 }, dateISO: { dateISO: !0 }, number: { number: !0 }, digits: { digits: !0 }, creditcard: { creditcard: !0 } }, addClassRules: function (b, c) { b.constructor === String ? this.classRuleSettings[b] = c : a.extend(this.classRuleSettings, b); }, classRules: function (b) { var c = {}, d = a(b).attr('class'); return d && a.each(d.split(' '), function () { this in a.validator.classRuleSettings && a.extend(c, a.validator.classRuleSettings[this]); }), c; }, normalizeAttributeRule: function (a, b, c, d) { /min|max|step/.test(c) && (null === b || /number|range|text/.test(b)) && (d = Number(d), isNaN(d) && (d = void 0)), d || 0 === d ? a[c] = d : b === c && 'range' !== b && (a[c] = !0); }, attributeRules: function (b) { var c, d, e = {}, f = a(b), g = b.getAttribute('type'); for (c in a.validator.methods) 'required' === c ? (d = b.getAttribute(c), '' === d && (d = !0), d = !!d) : d = f.attr(c), this.normalizeAttributeRule(e, g, c, d); return e.maxlength && /-1|2147483647|524288/.test(e.maxlength) && delete e.maxlength, e; }, dataRules: function (b) { var c, d, e = {}, f = a(b), g = b.getAttribute('type'); for (c in a.validator.methods) d = f.data('rule' + c.charAt(0).toUpperCase() + c.substring(1).toLowerCase()), this.normalizeAttributeRule(e, g, c, d); return e; }, staticRules: function (b) { var c = {}, d = a.data(b.form, 'validator'); return d.settings.rules && (c = a.validator.normalizeRule(d.settings.rules[b.name]) || {}), c; }, normalizeRules: function (b, c) { return a.each(b, function (d, e) { if (e === !1) return void delete b[d]; if (e.param || e.depends) { var f = !0; switch (typeof e.depends) { case 'string': f = !!a(e.depends, c.form).length; break; case 'function': f = e.depends.call(c, c); }f ? b[d] = void 0 === e.param || e.param : (a.data(c.form, 'validator').resetElements(a(c)), delete b[d]); } }), a.each(b, function (d, e) { b[d] = a.isFunction(e) && 'normalizer' !== d ? e(c) : e; }), a.each(['minlength', 'maxlength'], function () { b[this] && (b[this] = Number(b[this])); }), a.each(['rangelength', 'range'], function () { var c; b[this] && (a.isArray(b[this]) ? b[this] = [Number(b[this][0]), Number(b[this][1])] : 'string' == typeof b[this] && (c = b[this].replace(/[\[\]]/g, '').split(/[\s,]+/), b[this] = [Number(c[0]), Number(c[1])])); }), a.validator.autoCreateRanges && (null != b.min && null != b.max && (b.range = [b.min, b.max], delete b.min, delete b.max), null != b.minlength && null != b.maxlength && (b.rangelength = [b.minlength, b.maxlength], delete b.minlength, delete b.maxlength)), b; }, normalizeRule: function (b) { if ('string' == typeof b) { var c = {}; a.each(b.split(/\s/), function () { c[this] = !0; }), b = c; } return b; }, addMethod: function (b, c, d) { a.validator.methods[b] = c, a.validator.messages[b] = void 0 !== d ? d : a.validator.messages[b], c.length < 3 && a.validator.addClassRules(b, a.validator.normalizeRule(b)); }, methods: { required: function (b, c, d) { if (!this.depend(d, c)) return 'dependency-mismatch'; if ('select' === c.nodeName.toLowerCase()) { var e = a(c).val(); return e && e.length > 0; } return this.checkable(c) ? this.getLength(b, c) > 0 : b.length > 0; }, email: function (a, b) { return this.optional(b) || /^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test(a); }, url: function (a, b) { return this.optional(b) || /^(?:(?:(?:https?|ftp):)?\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})).?)(?::\d{2,5})?(?:[\/?#]\S*)?$/i.test(a); }, date: function (a, b) { return this.optional(b) || !/Invalid|NaN/.test(new Date(a).toString()); }, dateISO: function (a, b) { return this.optional(b) || /^\d{4}[\/\-](0?[1-9]|1[012])[\/\-](0?[1-9]|[12][0-9]|3[01])$/.test(a); }, number: function (a, b) { return this.optional(b) || /^(?:-?\d+|-?\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test(a); }, digits: function (a, b) { return this.optional(b) || /^\d+$/.test(a); }, minlength: function (b, c, d) { var e = a.isArray(b) ? b.length : this.getLength(b, c); return this.optional(c) || e >= d; }, maxlength: function (b, c, d) { var e = a.isArray(b) ? b.length : this.getLength(b, c); return this.optional(c) || e <= d; }, rangelength: function (b, c, d) { var e = a.isArray(b) ? b.length : this.getLength(b, c); return this.optional(c) || e >= d[0] && e <= d[1]; }, min: function (a, b, c) { return this.optional(b) || a >= c; }, max: function (a, b, c) { return this.optional(b) || a <= c; }, range: function (a, b, c) { return this.optional(b) || a >= c[0] && a <= c[1]; }, step: function (b, c, d) { var e, f = a(c).attr('type'), g = 'Step attribute on input type ' + f + ' is not supported.', h = ['text', 'number', 'range'], i = new RegExp('\\b' + f + '\\b'), j = f && !i.test(h.join()), k = function (a) { var b = ('' + a).match(/(?:\.(\d+))?$/); return b && b[1] ? b[1].length : 0; }, l = function (a) { return Math.round(a * Math.pow(10, e)); }, m = !0; if (j) throw new Error(g); return e = k(d), (k(b) > e || l(b) % l(d) !== 0) && (m = !1), this.optional(c) || m; }, equalTo: function (b, c, d) { var e = a(d); return this.settings.onfocusout && e.not('.validate-equalTo-blur').length && e.addClass('validate-equalTo-blur').on('blur.validate-equalTo', function () { a(c).valid(); }), b === e.val(); }, remote: function (b, c, d, e) { if (this.optional(c)) return 'dependency-mismatch'; e = 'string' == typeof e && e || 'remote'; var f, g, h, i = this.previousValue(c, e); return this.settings.messages[c.name] || (this.settings.messages[c.name] = {}), i.originalMessage = i.originalMessage || this.settings.messages[c.name][e], this.settings.messages[c.name][e] = i.message, d = 'string' == typeof d && { url: d } || d, h = a.param(a.extend({ data: b }, d.data)), i.old === h ? i.valid : (i.old = h, f = this, this.startRequest(c), g = {}, g[c.name] = b, a.ajax(a.extend(!0, { mode: 'abort', port: 'validate' + c.name, dataType: 'json', data: g, context: f.currentForm, success: function (a) { var d, g, h, j = a === !0 || 'true' === a; f.settings.messages[c.name][e] = i.originalMessage, j ? (h = f.formSubmitted, f.resetInternals(), f.toHide = f.errorsFor(c), f.formSubmitted = h, f.successList.push(c), f.invalid[c.name] = !1, f.showErrors()) : (d = {}, g = a || f.defaultMessage(c, { method: e, parameters: b }), d[c.name] = i.message = g, f.invalid[c.name] = !0, f.showErrors(d)), i.valid = j, f.stopRequest(c, j); } }, d)), 'pending'); } } }); var b, c = {}; return a.ajaxPrefilter ? a.ajaxPrefilter(function (a, b, d) { var e = a.port; 'abort' === a.mode && (c[e] && c[e].abort(), c[e] = d); }) : (b = a.ajax, a.ajax = function (d) { var e = ('mode' in d ? d : a.ajaxSettings).mode, f = ('port' in d ? d : a.ajaxSettings).port; return 'abort' === e ? (c[f] && c[f].abort(), c[f] = b.apply(this, arguments), c[f]) : b.apply(this, arguments); }), a; }), function (a) { 'function' == typeof define && define.amd ? define('jquery.validate.unobtrusive', ['jquery.validation'], a) : 'object' == typeof module && module.exports ? module.exports = a(require('jquery-validation')) : jQuery.validator.unobtrusive = a(jQuery); }(function (a) { function e(a, e, n) { a.rules[e] = n, a.message && (a.messages[e] = a.message); } function n(a) { return a.replace(/^\s+|\s+$/g, '').split(/\s*,\s*/g); } function t(a) { return a.replace(/([!"#$%&'()*+,.\/:;<=>?@\[\\\]^`{|}~])/g, '\\$1'); } function r(a) { return a.substr(0, a.lastIndexOf('.') + 1); } function i(a, e) { return 0 === a.indexOf('*.') && (a = a.replace('*.', e)), a; } function o(e, n) { var r = a(this).find("[data-valmsg-for='" + t(n[0].name) + "']"), i = r.attr('data-valmsg-replace'), o = i ? a.parseJSON(i) !== !1 : null; r.removeClass('field-validation-valid').addClass('field-validation-error'), e.data('unobtrusiveContainer', r), o ? (r.empty(), e.removeClass('input-validation-error').appendTo(r)) : e.hide(); } function d(e, n) { var t = a(this).find('[data-valmsg-summary=true]'), r = t.find('ul'); r && r.length && n.errorList.length && (r.empty(), t.addClass('validation-summary-errors').removeClass('validation-summary-valid'), a.each(n.errorList, function () { a('<li />').html(this.message).appendTo(r); })); } function s(e) { var n = e.data('unobtrusiveContainer'); if (n) { var t = n.attr('data-valmsg-replace'), r = t ? a.parseJSON(t) : null; n.addClass('field-validation-valid').removeClass('field-validation-error'), e.removeData('unobtrusiveContainer'), r && n.empty(); } } function l(e) { var n = a(this), t = '__jquery_unobtrusive_validation_form_reset'; if (!n.data(t)) { n.data(t, !0); try { n.data('validator').resetForm(); } finally { n.removeData(t); } n.find('.validation-summary-errors').addClass('validation-summary-valid').removeClass('validation-summary-errors'), n.find('.field-validation-error').addClass('field-validation-valid').removeClass('field-validation-error').removeData('unobtrusiveContainer').find('>*').removeData('unobtrusiveContainer'); } } function u(e) { var n = a(e), t = n.data(v), r = a.proxy(l, e), i = f.unobtrusive.options || {}, u = function (n, t) { var r = i[n]; r && a.isFunction(r) && r.apply(e, t); }; return t || (t = { options: { errorClass: i.errorClass || 'input-validation-error', errorElement: i.errorElement || 'span', errorPlacement: function () { o.apply(e, arguments), u('errorPlacement', arguments); }, invalidHandler: function () { d.apply(e, arguments), u('invalidHandler', arguments); }, messages: {}, rules: {}, success: function () { s.apply(e, arguments), u('success', arguments); } }, attachValidation: function () { n.off('reset.' + v, r).on('reset.' + v, r).validate(this.options); }, validate: function () { return n.validate(), n.valid(); } }, n.data(v, t)), t; } var m, f = a.validator, v = 'unobtrusiveValidation'; return f.unobtrusive = { adapters: [], parseElement: function (e, n) { var t, r, i, o = a(e), d = o.parents('form')[0]; d && (t = u(d), t.options.rules[e.name] = r = {}, t.options.messages[e.name] = i = {}, a.each(this.adapters, function () { var n = 'data-val-' + this.name, t = o.attr(n), s = {}; void 0 !== t && (n += '-', a.each(this.params, function () { s[this] = o.attr(n + this); }), this.adapt({ element: e, form: d, message: t, params: s, rules: r, messages: i })); }), a.extend(r, { __dummy__: !0 }), n || t.attachValidation()); }, parse: function (e) { var n = a(e), t = n.parents().addBack().filter('form').add(n.find('form')).has('[data-val=true]'); n.find('[data-val=true]').each(function () { f.unobtrusive.parseElement(this, !0); }), t.each(function () { var a = u(this); a && a.attachValidation(); }); } }, m = f.unobtrusive.adapters, m.add = function (a, e, n) { return n || (n = e, e = []), this.push({ name: a, params: e, adapt: n }), this; }, m.addBool = function (a, n) { return this.add(a, function (t) { e(t, n || a, !0); }); }, m.addMinMax = function (a, n, t, r, i, o) { return this.add(a, [i || 'min', o || 'max'], function (a) { var i = a.params.min, o = a.params.max; i && o ? e(a, r, [i, o]) : i ? e(a, n, i) : o && e(a, t, o); }); }, m.addSingleVal = function (a, n, t) { return this.add(a, [n || 'val'], function (r) { e(r, t || a, r.params[n]); }); }, f.addMethod('__dummy__', function (a, e, n) { return !0; }), f.addMethod('regex', function (a, e, n) { var t; return !!this.optional(e) || (t = new RegExp(n).exec(a), t && 0 === t.index && t[0].length === a.length); }), f.addMethod('nonalphamin', function (a, e, n) { var t; return n && (t = a.match(/\W/g), t = t && t.length >= n), t; }), f.methods.extension ? (m.addSingleVal('accept', 'mimtype'), m.addSingleVal('extension', 'extension')) : m.addSingleVal('extension', 'extension', 'accept'), m.addSingleVal('regex', 'pattern'), m.addBool('creditcard').addBool('date').addBool('digits').addBool('email').addBool('number').addBool('url'), m.addMinMax('length', 'minlength', 'maxlength', 'rangelength').addMinMax('range', 'min', 'max', 'range'), m.addMinMax('minlength', 'minlength').addMinMax('maxlength', 'minlength', 'maxlength'), m.add('equalto', ['other'], function (n) { var o = r(n.element.name), d = n.params.other, s = i(d, o), l = a(n.form).find(':input').filter("[name='" + t(s) + "']")[0]; e(n, 'equalTo', l); }), m.add('required', function (a) { 'INPUT' === a.element.tagName.toUpperCase() && 'CHECKBOX' === a.element.type.toUpperCase() || e(a, 'required', !0); }), m.add('remote', ['url', 'type', 'additionalfields'], function (o) { var d = { url: o.params.url, type: o.params.type || 'GET', data: {} }, s = r(o.element.name); a.each(n(o.params.additionalfields || o.element.name), function (e, n) { var r = i(n, s); d.data[r] = function () { var e = a(o.form).find(':input').filter("[name='" + t(r) + "']"); return e.is(':checkbox') ? e.filter(':checked').val() || e.filter(':hidden').val() || '' : e.is(':radio') ? e.filter(':checked').val() || '' : e.val(); }; }), e(o, 'remote', d); }), m.add('password', ['min', 'nonalphamin', 'regex'], function (a) { a.params.min && e(a, 'minlength', a.params.min), a.params.nonalphamin && e(a, 'nonalphamin', a.params.nonalphamin), a.params.regex && e(a, 'regex', a.params.regex); }), m.add('fileextensions', ['extensions'], function (a) { e(a, 'extension', a.params.extensions); }), a(function () { f.unobtrusive.parse(document); }), f.unobtrusive; }), !function (e, t) { 'object' == typeof exports && 'undefined' != typeof module ? module.exports = t() : 'function' == typeof define && define.amd ? define(t) : e.Sweetalert2 = t(); }(this, function () { 'use strict'; function e() { null === v.previousBodyPadding && document.body.scrollHeight > window.innerHeight && (v.previousBodyPadding = document.body.style.paddingRight, document.body.style.paddingRight = I() + 'px'); } function t() { null !== v.previousBodyPadding && (document.body.style.paddingRight = v.previousBodyPadding, v.previousBodyPadding = null); } function n() { if (void 0 === arguments[0]) return console.error('SweetAlert2 expects at least 1 attribute!'), !1; var e = f({}, K); switch (typeof arguments[0]) { case 'string': e.title = arguments[0], e.text = arguments[1] || '', e.type = arguments[2] || ''; break; case 'object': f(e, arguments[0]), e.extraParams = arguments[0].extraParams, 'email' === e.input && null === e.inputValidator && (e.inputValidator = function (e) { return new Promise(function (t, n) { var o = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/; o.test(e) ? t() : n('Invalid email address'); }); }); break; default: return console.error('SweetAlert2: Unexpected type of argument! Expected "string" or "object", got ' + typeof arguments[0]), !1; }U(e); var t = y(); return new Promise(function (n, i) { function a(t, n) { for (var o = x(e.focusCancel), r = 0; r < o.length; r++) { t += n, t === o.length ? t = 0 : -1 === t && (t = o.length - 1); var i = o[t]; if (O(i)) return i.focus(); } } function s(t) { var n = t || window.event, r = n.keyCode || n.which; if (-1 !== [9, 13, 32, 27].indexOf(r)) { for (var l = n.target || n.srcElement, s = x(e.focusCancel), c = -1, u = 0; u < s.length; u++)if (l === s[u]) { c = u; break; } 9 === r ? (n.shiftKey ? a(c, -1) : a(c, 1), N(n)) : 13 === r || 32 === r ? -1 === c && (e.focusCancel ? H(V, n) : H(E, n)) : 27 === r && e.allowEscapeKey === !0 && (o.closeModal(e.onClose), i('esc')); } } e.timer && (t.timeout = setTimeout(function () { o.closeModal(e.onClose), i('timer'); }, e.timer)); var c = function (n) { switch (n = n || e.input) { case 'select': case 'textarea': case 'file': return L(t, l[n]); case 'checkbox': return t.querySelector('.' + l.checkbox + ' input'); case 'radio': return t.querySelector('.' + l.radio + ' input:checked') || t.querySelector('.' + l.radio + ' input:first-child'); case 'range': return t.querySelector('.' + l.range + ' input'); default: return L(t, l.input); } }, u = function () { var t = c(); if (!t) return null; switch (e.input) { case 'checkbox': return t.checked ? 1 : 0; case 'radio': return t.checked ? t.value : null; case 'file': return t.files.length ? t.files[0] : null; default: return e.inputAutoTrim ? t.value.trim() : t.value; } }; e.input && setTimeout(function () { var e = c(); e && B(e); }, 0); var d, f = function (t) { e.showLoaderOnConfirm && o.showLoading(), e.preConfirm ? e.preConfirm(t, e.extraParams).then(function (r) { o.closeModal(e.onClose), n(r || t); }, function (e) { o.hideLoading(), e && o.showValidationError(e); }) : (o.closeModal(e.onClose), n(t)); }, h = function (t) { var n = t || window.event, r = n.target || n.srcElement, a = C(), l = k(), s = a === r || a.contains(r), c = l === r || l.contains(r); switch (n.type) { case 'mouseover': case 'mouseup': e.buttonsStyling && (s ? a.style.backgroundColor = m(e.confirmButtonColor, -0.1) : c && (l.style.backgroundColor = m(e.cancelButtonColor, -0.1))); break; case 'mouseout': e.buttonsStyling && (s ? a.style.backgroundColor = e.confirmButtonColor : c && (l.style.backgroundColor = e.cancelButtonColor)); break; case 'mousedown': e.buttonsStyling && (s ? a.style.backgroundColor = m(e.confirmButtonColor, -0.2) : c && (l.style.backgroundColor = m(e.cancelButtonColor, -0.2))); break; case 'click': if (s && o.isVisible()) if (e.input) { var d = u(); e.inputValidator ? (o.disableInput(), e.inputValidator(d, e.extraParams).then(function () { o.enableInput(), f(d); }, function (e) { o.enableInput(), e && o.showValidationError(e); })) : f(d); } else f(!0); else c && o.isVisible() && (o.closeModal(e.onClose), i('cancel')); } }, g = t.querySelectorAll('button'); for (d = 0; d < g.length; d++)g[d].onclick = h, g[d].onmouseover = h, g[d].onmouseout = h, g[d].onmousedown = h; S().onclick = function () { o.closeModal(e.onClose), i('close'); }, r.onclick = function (t) { t.target === r && e.allowOutsideClick && (o.closeModal(e.onClose), i('overlay')); }; var E = C(), V = k(); e.reverseButtons ? E.parentNode.insertBefore(V, E) : E.parentNode.insertBefore(E, V), v.previousWindowKeyDown = window.onkeydown, window.onkeydown = s, e.buttonsStyling && (E.style.borderLeftColor = e.confirmButtonColor, E.style.borderRightColor = e.confirmButtonColor), o.showLoading = o.enableLoading = function () { q(b()), q(E, 'inline-block'), P(E, 'loading'), P(t, 'loading'), E.disabled = !0, V.disabled = !0; }, o.hideLoading = o.disableLoading = function () { e.showConfirmButton || (M(E), e.showCancelButton || M(b())), A(E, 'loading'), A(t, 'loading'), E.disabled = !1, V.disabled = !1; }, o.enableButtons = function () { E.disabled = !1, V.disabled = !1; }, o.disableButtons = function () { E.disabled = !0, V.disabled = !0; }, o.enableConfirmButton = function () { E.disabled = !1; }, o.disableConfirmButton = function () { E.disabled = !0; }, o.enableInput = function () { var e = c(); if (!e) return !1; if ('radio' === e.type) for (var t = e.parentNode.parentNode, n = t.querySelectorAll('input'), o = 0; o < n.length; o++)n[o].disabled = !1; else e.disabled = !1; }, o.disableInput = function () { var e = c(); if (!e) return !1; if (e && 'radio' === e.type) for (var t = e.parentNode.parentNode, n = t.querySelectorAll('input'), o = 0; o < n.length; o++)n[o].disabled = !0; else e.disabled = !0; }, o.recalculateHeight = function () { var e = y() || o.init(), t = e.style.display; e.style.minHeight = '', q(e), e.style.minHeight = e.scrollHeight + 1 + 'px', e.style.display = t; }, o.showValidationError = function (e) { var n = t.querySelector('.' + l.validationerror); n.innerHTML = e, q(n); var o = c(); B(o), P(o, 'error'); }, o.resetValidationError = function () { var e = t.querySelector('.' + l.validationerror); M(e); var n = c(); n && A(n, 'error'); }, o.getProgressSteps = function () { return e.progressSteps; }, o.setProgressSteps = function (t) { e.progressSteps = t, U(e); }, o.showProgressSteps = function () { q(w()); }, o.hideProgressSteps = function () { M(w()); }, o.enableButtons(), o.hideLoading(), o.resetValidationError(); var T, j = ['input', 'file', 'range', 'select', 'radio', 'checkbox', 'textarea']; for (d = 0; d < j.length; d++) { var D = l[j[d]], I = L(t, D); if (T = c(j[d])) { for (var K in T.attributes) if (T.attributes.hasOwnProperty(K)) { var R = T.attributes[K].name; 'type' !== R && 'value' !== R && T.removeAttribute(R); } for (var Q in e.inputAttributes) T.setAttribute(Q, e.inputAttributes[Q]); } I.className = D, e.inputClass && P(I, e.inputClass), M(I); } var Y; switch (e.input) { case 'text': case 'email': case 'password': case 'number': case 'tel': T = L(t, l.input), T.value = e.inputValue, T.placeholder = e.inputPlaceholder, T.type = e.input, q(T); break; case 'file': T = L(t, l.file), T.placeholder = e.inputPlaceholder, T.type = e.input, q(T); break; case 'range': var Z = L(t, l.range), F = Z.querySelector('input'), J = Z.querySelector('output'); F.value = e.inputValue, F.type = e.input, J.value = e.inputValue, q(Z); break; case 'select': var $ = L(t, l.select); if ($.innerHTML = '', e.inputPlaceholder) { var _ = document.createElement('option'); _.innerHTML = e.inputPlaceholder, _.value = '', _.disabled = !0, _.selected = !0, $.appendChild(_); } Y = function (t) { for (var n in t) { var o = document.createElement('option'); o.value = n, o.innerHTML = t[n], e.inputValue === n && (o.selected = !0), $.appendChild(o); } q($), $.focus(); }; break; case 'radio': var G = L(t, l.radio); G.innerHTML = '', Y = function (t) { for (var n in t) { var o = 1, r = document.createElement('input'), i = document.createElement('label'), a = document.createElement('span'); r.type = 'radio', r.name = l.radio, r.value = n, r.id = l.radio + '-' + o++ , e.inputValue === n && (r.checked = !0), a.innerHTML = t[n], i.appendChild(r), i.appendChild(a), i['for'] = r.id, G.appendChild(i); } q(G); var s = G.querySelectorAll('input'); s.length && s[0].focus(); }; break; case 'checkbox': var X = L(t, l.checkbox), ee = c('checkbox'); ee.type = 'checkbox', ee.value = 1, ee.id = l.checkbox, ee.checked = Boolean(e.inputValue); var te = X.getElementsByTagName('span'); te.length && X.removeChild(te[0]), te = document.createElement('span'), te.innerHTML = e.inputPlaceholder, X.appendChild(te), q(X); break; case 'textarea': var ne = L(t, l.textarea); ne.value = e.inputValue, ne.placeholder = e.inputPlaceholder, q(ne); break; case null: break; default: console.error('SweetAlert2: Unexpected type of input! Expected "text" or "email" or "password", "select", "checkbox", "textarea" or "file", got "' + e.input + '"'); }if ('select' !== e.input && 'radio' !== e.input || (e.inputOptions instanceof Promise ? (o.showLoading(), e.inputOptions.then(function (e) { o.hideLoading(), Y(e); })) : 'object' == typeof e.inputOptions ? Y(e.inputOptions) : console.error('SweetAlert2: Unexpected type of inputOptions! Expected object or Promise, got ' + typeof e.inputOptions)), z(e.animation, e.onOpen), a(-1, 1), r.scrollTop = 0, 'undefined' != typeof MutationObserver && !p) { var oe = W(function () { o.recalculateHeight(); }, 50); p = new MutationObserver(oe), p.observe(t, { childList: !0, characterData: !0, subtree: !0 }); } }); } function o() { var e = arguments, t = y(); return null === t && (o.init(), t = y()), o.isVisible() && o.close(), n.apply(this, e); } var r, i = 'swal2-', a = function (e) { var t = {}; for (var n in e) t[e[n]] = i + e[n]; return t; }, l = a(['container', 'in', 'modal', 'overlay', 'close', 'content', 'spacer', 'confirm', 'cancel', 'icon', 'image', 'input', 'file', 'range', 'select', 'radio', 'checkbox', 'textarea', 'validationerror', 'progresssteps', 'activeprogressstep', 'progresscircle', 'progressline']), s = a(['success', 'warning', 'info', 'question', 'error']), c = { title: '', text: '', html: '', type: null, customClass: '', animation: !0, allowOutsideClick: !0, allowEscapeKey: !0, showConfirmButton: !0, showCancelButton: !1, preConfirm: null, confirmButtonText: 'OK', confirmButtonColor: '#3085d6', confirmButtonClass: null, cancelButtonText: 'Cancel', cancelButtonColor: '#aaa', cancelButtonClass: null, buttonsStyling: !0, reverseButtons: !1, focusCancel: !1, showCloseButton: !1, showLoaderOnConfirm: !1, imageUrl: null, imageWidth: null, imageHeight: null, imageClass: null, timer: null, width: 500, padding: 20, background: '#fff', input: null, inputPlaceholder: '', inputValue: '', inputOptions: {}, inputAutoTrim: !0, inputClass: null, inputAttributes: {}, inputValidator: null, progressSteps: [], currentProgressStep: null, progressStepsDistance: '40px', onOpen: null, onClose: null }, u = '<div class="' + l.modal + '" style="display: none" tabIndex="-1"><ul class="' + l.progresssteps + '"></ul><div class="' + l.icon + ' ' + s.error + '"><span class="x-mark"><span class="line left"></span><span class="line right"></span></span></div><div class="' + l.icon + ' ' + s.question + '">?</div><div class="' + l.icon + ' ' + s.warning + '">!</div><div class="' + l.icon + ' ' + s.info + '">i</div><div class="' + l.icon + ' ' + s.success + '"><span class="line tip"></span> <span class="line long"></span><div class="placeholder"></div> <div class="fix"></div></div><img class="' + l.image + '"><h2></h2><div class="' + l.content + '"></div><input class="' + l.input + '"><input type="file" class="' + l.file + '"><div class="' + l.range + '"><output></output><input type="range"></div><select class="' + l.select + '"></select><div class="' + l.radio + '"></div><label for="' + l.checkbox + '" class="' + l.checkbox + '"><input type="checkbox"></label><textarea class="' + l.textarea + '"></textarea><div class="' + l.validationerror + '"></div><hr class="' + l.spacer + '"><button type="button" class="' + l.confirm + '">OK</button><button type="button" class="' + l.cancel + '">Cancel</button><span class="' + l.close + '">&times;</span></div>', d = document.getElementsByClassName(l.container); d.length ? r = d[0] : (r = document.createElement('div'), r.className = l.container, r.innerHTML = u); var p, f = function (e, t) { for (var n in t) t.hasOwnProperty(n) && (e[n] = t[n]); return e; }, m = function (e, t) { e = String(e).replace(/[^0-9a-f]/gi, ''), e.length < 6 && (e = e[0] + e[0] + e[1] + e[1] + e[2] + e[2]), t = t || 0; for (var n = '#', o = 0; 3 > o; o++) { var r = parseInt(e.substr(2 * o, 2), 16); r = Math.round(Math.min(Math.max(0, r + r * t), 255)).toString(16), n += ('00' + r).substr(r.length); } return n; }, v = { previousWindowKeyDown: null, previousActiveElement: null, previousBodyPadding: null }, h = function (e) { return r.querySelector('.' + e); }, y = function () { return h(l.modal); }, g = function () { var e = y(); return e.querySelectorAll('.' + l.icon); }, b = function () { return h(l.spacer); }, w = function () { return h(l.progresssteps); }, C = function () { return h(l.confirm); }, k = function () { return h(l.cancel); }, S = function () { return h(l.close); }, x = function (e) { var t = [C(), k()]; return e && t.reverse(), t.concat(Array.prototype.slice.call(y().querySelectorAll('button:not([class^=' + i + ']), input:not([type=hidden]), textarea, select'))); }, E = function (e, t) { return e.classList.contains(t); }, B = function (e) { if (e.focus(), 'file' !== e.type) { var t = e.value; e.value = '', e.value = t; } }, P = function (e, t) { if (e && t) { var n = t.split(/\s+/); n.forEach(function (t) { e.classList.add(t); }); } }, A = function (e, t) { if (e && t) { var n = t.split(/\s+/); n.forEach(function (t) { e.classList.remove(t); }); } }, L = function (e, t) { for (var n = 0; n < e.childNodes.length; n++)if (E(e.childNodes[n], t)) return e.childNodes[n]; }, q = function (e, t) { t || (t = 'block'), e.style.opacity = '', e.style.display = t; }, M = function (e) { e.style.opacity = '', e.style.display = 'none'; }, V = function (e) { for (; e.firstChild;)e.removeChild(e.firstChild); }, O = function (e) { return e.offsetWidth || e.offsetHeight || e.getClientRects().length; }, T = function (e, t) { e.style.removeProperty ? e.style.removeProperty(t) : e.style.removeAttribute(t); }, H = function (e) { if ('function' == typeof MouseEvent) { var t = new MouseEvent('click', { view: window, bubbles: !1, cancelable: !0 }); e.dispatchEvent(t); } else if (document.createEvent) { var n = document.createEvent('MouseEvents'); n.initEvent('click', !1, !1), e.dispatchEvent(n); } else document.createEventObject ? e.fireEvent('onclick') : 'function' == typeof e.onclick && e.onclick(); }, N = function (e) { 'function' == typeof e.stopPropagation ? (e.stopPropagation(), e.preventDefault()) : window.event && window.event.hasOwnProperty('cancelBubble') && (window.event.cancelBubble = !0); }, j = function (e, t, n) { e = document.createElement('div'), t = { WebkitAnimation: 'webkitAnimationEnd', OAnimation: 'oAnimationEnd oanimationend', msAnimation: 'MSAnimationEnd', animation: 'animationend' }; for (n in t) if (t.hasOwnProperty(n) && void 0 !== e.style[n]) return t[n]; return !1; }(), D = function () { var e = y(); window.onkeydown = v.previousWindowKeyDown, v.previousActiveElement && v.previousActiveElement.focus && v.previousActiveElement.focus(), clearTimeout(e.timeout); }, I = function () { var e = document.createElement('div'); e.style.width = '50px', e.style.height = '50px', e.style.overflow = 'scroll', document.body.appendChild(e); var t = e.offsetWidth - e.clientWidth; return document.body.removeChild(e), t; }, W = function (e, t, n) { var o; return function () { var r = this, i = arguments, a = function () { o = null, n || e.apply(r, i); }, l = n && !o; clearTimeout(o), o = setTimeout(a, t), l && e.apply(r, i); }; }, K = f({}, c), R = [], U = function (e) { var t = y(); for (var n in e) c.hasOwnProperty(n) || 'extraParams' === n || console.warn('SweetAlert2: Unknown parameter "' + n + '"'); t.style.width = 'number' == typeof e.width ? e.width + 'px' : e.width, t.style.padding = e.padding + 'px', t.style.background = e.background; var o = t.querySelector('h2'), r = t.querySelector('.' + l.content), i = C(), a = k(), u = t.querySelector('.' + l.close); o.innerHTML = e.title.split('\n').join('<br>'); var d; if (e.text || e.html) { if ('object' == typeof e.html) if (r.innerHTML = '', 0 in e.html) for (d = 0; d in e.html; d++)r.appendChild(e.html[d].cloneNode(!0)); else r.appendChild(e.html.cloneNode(!0)); else r.innerHTML = e.html || e.text.split('\n').join('<br>'); q(r); } else M(r); e.showCloseButton ? q(u) : M(u), t.className = l.modal, e.customClass && P(t, e.customClass); var p = w(), f = parseInt(null === e.currentProgressStep ? swal.getQueueStep() : e.currentProgressStep, 10); e.progressSteps.length ? (q(p), V(p), f >= e.progressSteps.length && console.warn('SweetAlert2: Invalid currentProgressStep parameter, it should be less than progressSteps.length (currentProgressStep like JS arrays starts from 0)'), e.progressSteps.forEach(function (t, n) { var o = document.createElement('li'); if (P(o, l.progresscircle), o.innerHTML = t, n === f && P(o, l.activeprogressstep), p.appendChild(o), n !== e.progressSteps.length - 1) { var r = document.createElement('li'); P(r, l.progressline), r.style.width = e.progressStepsDistance, p.appendChild(r); } })) : M(p); var m = g(); for (d = 0; d < m.length; d++)M(m[d]); if (e.type) { var v = !1; for (var h in s) if (e.type === h) { v = !0; break; } if (!v) return console.error('SweetAlert2: Unknown alert type: ' + e.type), !1; var S = t.querySelector('.' + l.icon + '.' + s[e.type]); switch (q(S), e.type) { case 'success': P(S, 'animate'), P(S.querySelector('.tip'), 'animate-success-tip'), P(S.querySelector('.long'), 'animate-success-long'); break; case 'error': P(S, 'animate-error-icon'), P(S.querySelector('.x-mark'), 'animate-x-mark'); break; case 'warning': P(S, 'pulse-warning'); } } var x = t.querySelector('.' + l.image); e.imageUrl ? (x.setAttribute('src', e.imageUrl), q(x), e.imageWidth ? x.setAttribute('width', e.imageWidth) : x.removeAttribute('width'), e.imageHeight ? x.setAttribute('height', e.imageHeight) : x.removeAttribute('height'), x.className = l.image, e.imageClass && P(x, e.imageClass)) : M(x), e.showCancelButton ? a.style.display = 'inline-block' : M(a), e.showConfirmButton ? T(i, 'display') : M(i); var E = b(); e.showConfirmButton || e.showCancelButton ? q(E) : M(E), i.innerHTML = e.confirmButtonText, a.innerHTML = e.cancelButtonText, e.buttonsStyling && (i.style.backgroundColor = e.confirmButtonColor, a.style.backgroundColor = e.cancelButtonColor), i.className = l.confirm, P(i, e.confirmButtonClass), a.className = l.cancel, P(a, e.cancelButtonClass), e.buttonsStyling ? (P(i, 'styled'), P(a, 'styled')) : (A(i, 'styled'), A(a, 'styled'), i.style.backgroundColor = i.style.borderLeftColor = i.style.borderRightColor = '', a.style.backgroundColor = a.style.borderLeftColor = a.style.borderRightColor = ''), e.animation === !0 ? A(t, 'no-animation') : P(t, 'no-animation'); }, z = function (t, n) { var o = y(); t ? (P(o, 'show-swal2'), P(r, 'fade'), A(o, 'hide-swal2')) : A(o, 'fade'), q(o), r.style.overflowY = 'hidden', j && !E(o, 'no-animation') ? o.addEventListener(j, function i() { o.removeEventListener(j, i), r.style.overflowY = 'auto'; }) : r.style.overflowY = 'auto', P(r, 'in'), P(document.body, l['in']), e(), v.previousActiveElement = document.activeElement, null !== n && 'function' == typeof n && n.call(this, o); }; return o.isVisible = function () { var e = y(); return O(e); }, o.queue = function (e) { R = e; var t = y() || o.init(), n = function () { R = [], t.removeAttribute('data-queue-step'); }; return new Promise(function (e, r) { (function i(a, l) { a < R.length ? (t.setAttribute('data-queue-step', a), o(R[a]).then(function () { i(a + 1, l); }, function (e) { n(), r(e); })) : (n(), e()); }(0)); }); }, o.getQueueStep = function () { return y().getAttribute('data-queue-step'); }, o.insertQueueStep = function (e, t) { return t && t < R.length ? R.splice(t, 0, e) : R.push(e); }, o.deleteQueueStep = function (e) { void 0 !== R[e] && R.splice(e, 1); }, o.close = o.closeModal = function (e) { var n = y(); A(n, 'show-swal2'), P(n, 'hide-swal2'); var o = n.querySelector('.' + l.icon + '.' + s.success); A(o, 'animate'), A(o.querySelector('.tip'), 'animate-success-tip'), A(o.querySelector('.long'), 'animate-success-long'); var i = n.querySelector('.' + l.icon + '.' + s.error); A(i, 'animate-error-icon'), A(i.querySelector('.x-mark'), 'animate-x-mark'); var a = n.querySelector('.' + l.icon + '.' + s.warning); A(a, 'pulse-warning'), D(), j && !E(n, 'no-animation') ? n.addEventListener(j, function c() { n.removeEventListener(j, c), E(n, 'hide-swal2') && (M(n), A(r, 'in'), A(document.body, l['in']), t()); }) : (M(n), A(r, 'in'), A(document.body, l['in']), t()), null !== e && 'function' == typeof e && e.call(this, n); }, o.clickConfirm = function () { C().click(); }, o.clickCancel = function () { k().click(); }, o.init = function () { if ('undefined' == typeof document) return void console.error('SweetAlert2 requires document to initialize'); if (!document.getElementsByClassName(l.container).length) { document.body.appendChild(r); var e = y(), t = L(e, l.input), n = L(e, l.file), i = e.querySelector('.' + l.range + ' input'), a = L(e, l.select), s = e.querySelector('.' + l.checkbox + ' input'), c = L(e, l.textarea); return t.oninput = function () { o.resetValidationError(); }, t.onkeyup = function (e) { e.stopPropagation(), 13 === e.keyCode && o.clickConfirm(); }, n.onchange = function () { o.resetValidationError(); }, i.oninput = function () { o.resetValidationError(), i.previousSibling.value = i.value; }, i.onchange = function () { o.resetValidationError(), i.previousSibling.value = i.value; }, a.onchange = function () { o.resetValidationError(); }, s.onchange = function () { o.resetValidationError(); }, c.oninput = function () { o.resetValidationError(); }, e; } }, o.setDefaults = function (e) { if (!e) throw new Error('userParams is required'); if ('object' != typeof e) throw new Error('userParams has to be a object'); f(K, e); }, o.resetDefaults = function () { K = f({}, c); }, o.version = '5.0.7', window.sweetAlert = window.swal = o, function () { 'complete' === document.readyState || 'interactive' === document.readyState && document.body ? o.init() : document.addEventListener('DOMContentLoaded', function e() { document.removeEventListener('DOMContentLoaded', e, !1), o.init(); }, !1); }(), 'function' == typeof Promise ? Promise.prototype.done = Promise.prototype.done || function () { return this['catch'](function () { }); } : console.warn('SweetAlert2: Please inlude Promise polyfill BEFORE including sweetalert2.js if IE10+ support needed.'), o; }));